<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Show SQL queries on Tinker | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/33.6be9bedc.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/25.53994f14.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/37.fe79cc5b.js"><link rel="prefetch" href="/assets/js/38.aef7ef02.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/45.b0f0f5f2.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/54.e1e107ff.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/6.70c0bce3.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    PHP
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    Laravel
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    Tinker
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>Show SQL queries on Tinker</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Mar 1, 2021</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    3 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>If you want to echo the SQL queries being executed on Tinker:
</p> <p>Add <code>.psysh.php</code> to your project:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;[<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">time</span><span class="token punctuation">}</span></span>ms] <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">sql</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Now, whenever Tinker executes a query, it logs on screen:
<img src="/assets/img/tinker-sql.99a2c1a1.png" alt="Tinker showing query"></p> <h2 id="improved-version"><a href="#improved-version" class="header-anchor">#</a> Improved version</h2> <p>If you want this improved version
<img src="/assets/img/tinker-sql-improved.96ea5366.png" alt="SQL with colors"></p> <p>Use this snippet instead:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Output<span class="token punctuation">\</span>ConsoleOutput</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Formatter<span class="token punctuation">\</span>OutputFormatterStyle</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">generate_color_console</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Reference: https://symfony.com/doc/current/console/coloring.html */</span>
    <span class="token variable">$output</span>       <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsoleOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$redStyle</span>     <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'#ff0000'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'bold'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$cyanStyle</span>    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cyan'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'bold'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$purpleStyle</span>  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'#9b6bdf'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'bold'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$yellowStyle</span>  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'yellow'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'bold'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$greenStyle</span>   <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'green'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'bold'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$magentaStyle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'#ff00ff'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'bold'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$whiteStyle</span>   <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputFormatterStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'#ffffff'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'label'</span><span class="token punctuation">,</span> <span class="token variable">$cyanStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select'</span><span class="token punctuation">,</span> <span class="token variable">$purpleStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$yellowStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'insert'</span><span class="token punctuation">,</span> <span class="token variable">$greenStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'delete'</span><span class="token punctuation">,</span> <span class="token variable">$magentaStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'default'</span><span class="token punctuation">,</span> <span class="token variable">$redStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">getFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'params'</span><span class="token punctuation">,</span> <span class="token variable">$whiteStyle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Given an INSERT query, return the column name of each `?`.
 *
 * @param string $sql Example:
 *   `INSERT INTO users(id, `name`, created_at) VALUES(?, ?, ?)`
 *
 * @return string[] Example: `['id', 'name', 'date']`
 *
 */</span>
<span class="token keyword">function</span> <span class="token function">get_binding_names_from_insert</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get column names. Ex.: &quot;'id, `name`, created_at'&quot;.</span>
    <span class="token variable">$matches</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$success</span> <span class="token operator">=</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/INSERT *INTO *[^(]*\(([^)]+)\)/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">===</span> <span class="token variable">$success</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$names_str</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Split: ['id, 'name', created_at']</span>
    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/([a-z0-9_]+)/i'</span><span class="token punctuation">,</span> <span class="token variable">$names_str</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Given a SQL, return the column name of each `?`.
 *
 * @param string $sql Example:
 *   `SELECT * FROM users
 *    WHERE `users`.`id` = ? AND created_at &lt;= ? LIMIT ?`
 *
 * @return string[] Example: `['id', 'created_at', 'LIMIT']`
 *
 */</span>
<span class="token keyword">function</span> <span class="token function">get_binding_names_from_expressions</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// For each `?`, get the two previous words.</span>
    <span class="token variable">$matches</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/([\S]*) *([\S]*) *\?/'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Sample: [&quot;`users`.`id` = ?&quot;, &quot;`users`.`deleted_at` &gt;= ?&quot;, &quot; LIMIT ?&quot;]</span>
    <span class="token variable">$expressions</span> <span class="token operator">=</span> <span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the first word of each expression. Sample: [&quot;`users`.`id`&quot;, &quot;`users`.`deleted_at`&quot;, &quot;LIMIT&quot;]</span>
    <span class="token variable">$first_words</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$words</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$words</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token variable">$expressions</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Extract &quot;column&quot; from &quot;`table`.`column`&quot;.</span>
    <span class="token variable">$names</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$matches</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/`(.*?)`/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$match</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$match</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$name</span> <span class="token operator">?</span> <span class="token variable">$name</span> <span class="token punctuation">:</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token variable">$first_words</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$names</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">generate_color_console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Change reserved words to uppercase (not the full list, just some main ones).</span>
    <span class="token variable">$reserved</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'SELECT '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'UPDATE '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'INSERT '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'DELETE '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'BEGIN'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'COMMIT'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ROLLBACK'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' FROM '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">' LEFT JOIN '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' RIGHT JOIN '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' FULL JOIN '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">' INNER JOIN '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' OUTER JOIN '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' JOIN '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">' WHERE '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' LIMIT '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' ORDER BY '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' SET '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">' UNION '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' LIKE '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' IS NULL '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' IS NOT NULL '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'INSERT INTO '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' IN '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'CREATE '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'DROP '</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'ALTER '</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">' VALUES '</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$reserved</span><span class="token punctuation">,</span> <span class="token variable">$reserved</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Each statement type has a different color.</span>
    <span class="token variable">$statements</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'SELECT'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'UPDATE'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'INSERT'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$words</span>      <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$first_word</span> <span class="token operator">=</span> <span class="token function">strtoupper</span><span class="token punctuation">(</span><span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$words</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Wrap SQL in a color tag (ex. &lt;select&gt;, &lt;update&gt;, etc).</span>
    <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$first_word</span><span class="token punctuation">,</span> <span class="token variable">$statements</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$first_word</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'default'</span><span class="token punctuation">;</span>
    <span class="token variable">$tag</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$tag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Margin + &quot;SQL&quot; label + Timing + SQL.</span>
    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;  &lt;label&gt;SQL (<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">time</span><span class="token punctuation">}</span></span>ms)&lt;label&gt;  &lt;<span class="token interpolation"><span class="token variable">$tag</span></span>&gt;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$sql</span><span class="token punctuation">}</span></span>&lt;/<span class="token interpolation"><span class="token variable">$tag</span></span>&gt;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// Add Bindings.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$names</span> <span class="token operator">=</span> <span class="token function">get_binding_names_from_insert</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">===</span> <span class="token variable">$names</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$names</span> <span class="token operator">=</span> <span class="token function">get_binding_names_from_expressions</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">===</span> <span class="token variable">$names</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$names</span> <span class="token operator">=</span> <span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">bindings</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token property">bindings</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$names</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;['<span class="token interpolation"><span class="token variable">$name</span></span>', '<span class="token interpolation"><span class="token variable">$value</span></span>']&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$params_str</span> <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token variable">$str</span></span>  &lt;params&gt;[<span class="token interpolation"><span class="token variable">$params_str</span></span>]&lt;/params&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Output final string.</span>
    <span class="token variable">$output</span><span class="token operator">-&gt;</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/33.6be9bedc.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
