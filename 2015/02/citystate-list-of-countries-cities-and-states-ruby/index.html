<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CityState Gem: Cities, states and countries in Ruby/Rails | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/45.b0f0f5f2.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/25.53994f14.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/33.6be9bedc.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/37.fe79cc5b.js"><link rel="prefetch" href="/assets/js/38.aef7ef02.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/54.e1e107ff.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/6.70c0bce3.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    Rails
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    Ruby
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    Gem
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>CityState Gem: Cities, states and countries in Ruby/Rails</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Feb 15, 2015</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    5 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>Let's say you have a form asking for a city and state. How do you populate these fields?</p> <p>This requirement is omnipresent in almost every website, and yet there's no library to deal with this.
</p> <p>Maybe it's a regional need, specific to my country, IDK, I just know that is very common for my clients to ask for a form with these fields. So, in my day-to-day programmer's life, I have to copy-and-paste snippets with a list of states and cities.</p> <p>I usually do something like this:</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> states <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token constant">AK</span><span class="token punctuation">:</span> <span class="token string">&quot;Alaska&quot;</span><span class="token punctuation">,</span> <span class="token constant">AL</span><span class="token punctuation">:</span> <span class="token string">&quot;Alabama&quot;</span><span class="token punctuation">,</span> <span class="token constant">AR</span><span class="token punctuation">:</span> <span class="token string">&quot;Arkansas&quot;</span><span class="token punctuation">,</span> <span class="token constant">AZ</span><span class="token punctuation">:</span> <span class="token string">&quot;Arizona&quot;</span><span class="token punctuation">,</span> <span class="token constant">CA</span><span class="token punctuation">:</span> <span class="token string">&quot;California&quot;</span><span class="token punctuation">,</span> <span class="token constant">CO</span><span class="token punctuation">:</span> <span class="token string">&quot;Colorado&quot;</span><span class="token punctuation">,</span> <span class="token constant">CT</span><span class="token punctuation">:</span> <span class="token string">&quot;Connecticut&quot;</span><span class="token punctuation">,</span> <span class="token constant">DC</span><span class="token punctuation">:</span> <span class="token string">&quot;District of Columbia&quot;</span><span class="token punctuation">,</span> <span class="token constant">DE</span><span class="token punctuation">:</span> <span class="token string">&quot;Delaware&quot;</span><span class="token punctuation">,</span> <span class="token constant">FL</span><span class="token punctuation">:</span> <span class="token string">&quot;Florida&quot;</span><span class="token punctuation">,</span> <span class="token constant">GA</span><span class="token punctuation">:</span> <span class="token string">&quot;Georgia&quot;</span><span class="token punctuation">,</span> <span class="token constant">HI</span><span class="token punctuation">:</span> <span class="token string">&quot;Hawaii&quot;</span><span class="token punctuation">,</span> <span class="token constant">IA</span><span class="token punctuation">:</span> <span class="token string">&quot;Iowa&quot;</span><span class="token punctuation">,</span> <span class="token constant">ID</span><span class="token punctuation">:</span> <span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">,</span> <span class="token constant">IL</span><span class="token punctuation">:</span> <span class="token string">&quot;Illinois&quot;</span><span class="token punctuation">,</span> <span class="token constant">IN</span><span class="token punctuation">:</span> <span class="token string">&quot;Indiana&quot;</span><span class="token punctuation">,</span> <span class="token constant">KS</span><span class="token punctuation">:</span> <span class="token string">&quot;Kansas&quot;</span><span class="token punctuation">,</span> <span class="token constant">KY</span><span class="token punctuation">:</span> <span class="token string">&quot;Kentucky&quot;</span><span class="token punctuation">,</span> <span class="token constant">LA</span><span class="token punctuation">:</span> <span class="token string">&quot;Louisiana&quot;</span><span class="token punctuation">,</span> <span class="token constant">MA</span><span class="token punctuation">:</span> <span class="token string">&quot;Massachusetts&quot;</span><span class="token punctuation">,</span> <span class="token constant">MD</span><span class="token punctuation">:</span> <span class="token string">&quot;Maryland&quot;</span><span class="token punctuation">,</span> <span class="token constant">ME</span><span class="token punctuation">:</span> <span class="token string">&quot;Maine&quot;</span><span class="token punctuation">,</span> <span class="token constant">MI</span><span class="token punctuation">:</span> <span class="token string">&quot;Michigan&quot;</span><span class="token punctuation">,</span> <span class="token constant">MN</span><span class="token punctuation">:</span> <span class="token string">&quot;Minnesota&quot;</span><span class="token punctuation">,</span> <span class="token constant">MO</span><span class="token punctuation">:</span> <span class="token string">&quot;Missouri&quot;</span><span class="token punctuation">,</span> <span class="token constant">MS</span><span class="token punctuation">:</span> <span class="token string">&quot;Mississippi&quot;</span><span class="token punctuation">,</span> <span class="token constant">MT</span><span class="token punctuation">:</span> <span class="token string">&quot;Montana&quot;</span><span class="token punctuation">,</span> <span class="token constant">NC</span><span class="token punctuation">:</span> <span class="token string">&quot;North Carolina&quot;</span><span class="token punctuation">,</span> <span class="token constant">ND</span><span class="token punctuation">:</span> <span class="token string">&quot;North Dakota&quot;</span><span class="token punctuation">,</span> <span class="token constant">NE</span><span class="token punctuation">:</span> <span class="token string">&quot;Nebraska&quot;</span><span class="token punctuation">,</span> <span class="token constant">NH</span><span class="token punctuation">:</span> <span class="token string">&quot;New Hampshire&quot;</span><span class="token punctuation">,</span> <span class="token constant">NJ</span><span class="token punctuation">:</span> <span class="token string">&quot;New Jersey&quot;</span><span class="token punctuation">,</span> <span class="token constant">NM</span><span class="token punctuation">:</span> <span class="token string">&quot;New Mexico&quot;</span><span class="token punctuation">,</span> <span class="token constant">NV</span><span class="token punctuation">:</span> <span class="token string">&quot;Nevada&quot;</span><span class="token punctuation">,</span> <span class="token constant">NY</span><span class="token punctuation">:</span> <span class="token string">&quot;New York&quot;</span><span class="token punctuation">,</span> <span class="token constant">OH</span><span class="token punctuation">:</span> <span class="token string">&quot;Ohio&quot;</span><span class="token punctuation">,</span> <span class="token constant">OK</span><span class="token punctuation">:</span> <span class="token string">&quot;Oklahoma&quot;</span><span class="token punctuation">,</span> <span class="token constant">OR</span><span class="token punctuation">:</span> <span class="token string">&quot;Oregon&quot;</span><span class="token punctuation">,</span> <span class="token constant">PA</span><span class="token punctuation">:</span> <span class="token string">&quot;Pennsylvania&quot;</span><span class="token punctuation">,</span> <span class="token constant">RI</span><span class="token punctuation">:</span> <span class="token string">&quot;Rhode Island&quot;</span><span class="token punctuation">,</span> <span class="token constant">SC</span><span class="token punctuation">:</span> <span class="token string">&quot;South Carolina&quot;</span><span class="token punctuation">,</span> <span class="token constant">SD</span><span class="token punctuation">:</span> <span class="token string">&quot;South Dakota&quot;</span><span class="token punctuation">,</span> <span class="token constant">TN</span><span class="token punctuation">:</span> <span class="token string">&quot;Tennessee&quot;</span><span class="token punctuation">,</span> <span class="token constant">TX</span><span class="token punctuation">:</span> <span class="token string">&quot;Texas&quot;</span><span class="token punctuation">,</span> <span class="token constant">UT</span><span class="token punctuation">:</span> <span class="token string">&quot;Utah&quot;</span><span class="token punctuation">,</span> <span class="token constant">VA</span><span class="token punctuation">:</span> <span class="token string">&quot;Virginia&quot;</span><span class="token punctuation">,</span> <span class="token constant">VT</span><span class="token punctuation">:</span> <span class="token string">&quot;Vermont&quot;</span><span class="token punctuation">,</span> <span class="token constant">WA</span><span class="token punctuation">:</span> <span class="token string">&quot;Washington&quot;</span><span class="token punctuation">,</span> <span class="token constant">WI</span><span class="token punctuation">:</span> <span class="token string">&quot;Wisconsin&quot;</span><span class="token punctuation">,</span> <span class="token constant">WV</span><span class="token punctuation">:</span> <span class="token string">&quot;West Virginia&quot;</span><span class="token punctuation">,</span> <span class="token constant">WY</span><span class="token punctuation">:</span> <span class="token string">&quot;Wyoming&quot;</span><span class="token punctuation">}</span> <span class="token delimiter punctuation">%&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form[state]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> states<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>key<span class="token punctuation">,</span> value<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> key <span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> value <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Of course, I use a list of states of my own country.</p> <p>I do the same thing for the cities (I use a YAML file for them), which isn't a very neat solution – hard coding your data is never a neat solution. Actually, it is even worse, because new cities are created every month in my country (so, the city list gets easily outdated).</p> <p>Looking for a better solution, I found this <a href="https://github.com/jim/carmen" target="_blank" rel="noopener noreferrer">Carmen Gem<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which provides a list of states from every country in the world, but unfortunately, it doesn't provide a list of cities. Also, it has a big and frightening warning that the gem is outdated.</p> <p>To solve this problem, I created a gem called <a href="https://github.com/loureirorg/city-state" target="_blank" rel="noopener noreferrer">city-state<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This gem provides an easy way to get a list of all states of a country, and also a list of all cities from each state.</p> <p>It has an auto-update mechanism, so I don't have to manually update the gem's database from time to time. This prevents it from getting outdated.</p> <p>This gem uses the <strong>MaxMind</strong> database, a very popular database used on many websites – usually with the purpose of discovering the IP localization – and it's updated weekly. My logic is that each city/town in the world has at least one IP address assigned to it, making the IP database a reliable source of cities and states.</p> <h2 id="install"><a href="#install" class="header-anchor">#</a> Install</h2> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># Gemfile</span>
gem <span class="token string">'city-state'</span>
</code></pre></div><h2 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h2> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">CS</span><span class="token punctuation">.</span>states<span class="token punctuation">(</span><span class="token symbol">:us</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt; {:AK=&gt;&quot;Alaska&quot;, :AL=&gt;&quot;Alabama&quot;, :AR=&gt;&quot;Arkansas&quot;, :AZ=&gt;&quot;Arizona&quot;, :CA=&gt;&quot;California&quot;, :CO=&gt;&quot;Colorado&quot;, :CT=&gt;&quot;Connecticut&quot;, :DC=&gt;&quot;District of Columbia&quot;, :DE=&gt;&quot;Delaware&quot;, :FL=&gt;&quot;Florida&quot;, :GA=&gt;&quot;Georgia&quot;, :HI=&gt;&quot;Hawaii&quot;, :IA=&gt;&quot;Iowa&quot;, :ID=&gt;&quot;Idaho&quot;, :IL=&gt;&quot;Illinois&quot;, :IN=&gt;&quot;Indiana&quot;, :KS=&gt;&quot;Kansas&quot;, :KY=&gt;&quot;Kentucky&quot;, :LA=&gt;&quot;Louisiana&quot;, :MA=&gt;&quot;Massachusetts&quot;, :MD=&gt;&quot;Maryland&quot;, :ME=&gt;&quot;Maine&quot;, :MI=&gt;&quot;Michigan&quot;, :MN=&gt;&quot;Minnesota&quot;, :MO=&gt;&quot;Missouri&quot;, :MS=&gt;&quot;Mississippi&quot;, :MT=&gt;&quot;Montana&quot;, :NC=&gt;&quot;North Carolina&quot;, :ND=&gt;&quot;North Dakota&quot;, :NE=&gt;&quot;Nebraska&quot;, :NH=&gt;&quot;New Hampshire&quot;, :NJ=&gt;&quot;New Jersey&quot;, :NM=&gt;&quot;New Mexico&quot;, :NV=&gt;&quot;Nevada&quot;, :NY=&gt;&quot;New York&quot;, :OH=&gt;&quot;Ohio&quot;, :OK=&gt;&quot;Oklahoma&quot;, :OR=&gt;&quot;Oregon&quot;, :PA=&gt;&quot;Pennsylvania&quot;, :RI=&gt;&quot;Rhode Island&quot;, :SC=&gt;&quot;South Carolina&quot;, :SD=&gt;&quot;South Dakota&quot;, :TN=&gt;&quot;Tennessee&quot;, :TX=&gt;&quot;Texas&quot;, :UT=&gt;&quot;Utah&quot;, :VA=&gt;&quot;Virginia&quot;, :VT=&gt;&quot;Vermont&quot;, :WA=&gt;&quot;Washington&quot;, :WI=&gt;&quot;Wisconsin&quot;, :WV=&gt;&quot;West Virginia&quot;, :WY=&gt;&quot;Wyoming&quot;}</span>

<span class="token constant">CS</span><span class="token punctuation">.</span>cities<span class="token punctuation">(</span><span class="token symbol">:ak</span><span class="token punctuation">,</span> <span class="token symbol">:us</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt; [&quot;Adak&quot;, &quot;Akhiok&quot;, &quot;Akiachak&quot;, &quot;Akiak&quot;, &quot;Akutan&quot;, &quot;Alakanuk&quot;, &quot;Ambler&quot;, &quot;Anchor Point&quot;, &quot;Anchorage&quot;, &quot;Angoon&quot;, &quot;Atqasuk&quot;, &quot;Barrow&quot;, &quot;Bell Island Hot Springs&quot;, &quot;Bethel&quot;, &quot;Big Lake&quot;, &quot;Buckland&quot;, &quot;Chefornak&quot;, &quot;Chevak&quot;, &quot;Chicken&quot;, &quot;Chugiak&quot;, &quot;Coffman Cove&quot;, &quot;Cooper Landing&quot;, &quot;Copper Center&quot;, &quot;Cordova&quot;, &quot;Craig&quot;, &quot;Deltana&quot;, &quot;Dillingham&quot;, &quot;Douglas&quot;, &quot;Dutch Harbor&quot;, &quot;Eagle River&quot;, &quot;Eielson Air Force Base&quot;, &quot;Fairbanks&quot;, &quot;Fairbanks North Star Borough&quot;, &quot;Fort Greely&quot;, &quot;Fort Richardson&quot;, &quot;Galena&quot;, &quot;Girdwood&quot;, &quot;Goodnews Bay&quot;, &quot;Haines&quot;, &quot;Homer&quot;, &quot;Hooper Bay&quot;, &quot;Juneau&quot;, &quot;Kake&quot;, &quot;Kaktovik&quot;, &quot;Kalskag&quot;, &quot;Kenai&quot;, &quot;Ketchikan&quot;, &quot;Kiana&quot;, &quot;King Cove&quot;, &quot;King Salmon&quot;, &quot;Kipnuk&quot;, &quot;Klawock&quot;, &quot;Kodiak&quot;, &quot;Kongiganak&quot;, &quot;Kotlik&quot;, &quot;Koyuk&quot;, &quot;Kwethluk&quot;, &quot;Levelock&quot;, &quot;Manokotak&quot;, &quot;May Creek&quot;, &quot;Mekoryuk&quot;, &quot;Metlakatla&quot;, &quot;Mountain Village&quot;, &quot;Nabesna&quot;, &quot;Naknek&quot;, &quot;Nazan Village&quot;, &quot;Nenana&quot;, &quot;New Stuyahok&quot;, &quot;Nikiski&quot;, &quot;Ninilchik&quot;, &quot;Noatak&quot;, &quot;Nome&quot;, &quot;Nondalton&quot;, &quot;Noorvik&quot;, &quot;North Pole&quot;, &quot;Northway&quot;, &quot;Old Kotzebue&quot;, &quot;Palmer&quot;, &quot;Pedro Bay&quot;, &quot;Petersburg&quot;, &quot;Pilot Station&quot;, &quot;Point Hope&quot;, &quot;Point Lay&quot;, &quot;Prudhoe Bay&quot;, &quot;Russian Mission&quot;, &quot;Sand Point&quot;, &quot;Scammon Bay&quot;, &quot;Selawik&quot;, &quot;Seward&quot;, &quot;Shungnak&quot;, &quot;Sitka&quot;, &quot;Skaguay&quot;, &quot;Soldotna&quot;, &quot;Stebbins&quot;, &quot;Sterling&quot;, &quot;Sutton&quot;, &quot;Talkeetna&quot;, &quot;Teller&quot;, &quot;Thorne Bay&quot;, &quot;Togiak&quot;, &quot;Tok&quot;, &quot;Toksook Bay&quot;, &quot;Tuntutuliak&quot;, &quot;Two Rivers&quot;, &quot;Unalakleet&quot;, &quot;Unalaska&quot;, &quot;Valdez&quot;, &quot;Wainwright&quot;, &quot;Wasilla&quot;]</span>
</code></pre></div><h2 id="updating-the-database-from-the-internet"><a href="#updating-the-database-from-the-internet" class="header-anchor">#</a> Updating the database from the internet</h2> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token constant">CS</span><span class="token punctuation">.</span>set_license_key<span class="token punctuation">(</span><span class="token string">'MY_KEY'</span><span class="token punctuation">)</span>
<span class="token constant">CS</span><span class="token punctuation">.</span>update
</code></pre></div><h3 id="maxmind-requires-a-license-key-for-free-to-get-download-updates"><a href="#maxmind-requires-a-license-key-for-free-to-get-download-updates" class="header-anchor">#</a> MaxMind requires a license key (for free) to get download updates</h3> <p>To get the license key:</p> <ul><li>Sign up for a MaxMind account: <a href="https://www.maxmind.com/en/geolite2/signup" target="_blank" rel="noopener noreferrer">https://www.maxmind.com/en/geolite2/signup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>;</li> <li>Create a license key: <a href="https://www.maxmind.com/en/accounts/current/license-key" target="_blank" rel="noopener noreferrer">https://www.maxmind.com/en/accounts/current/license-key<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>;</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>MaxMind update their databases weekly on Tuesdays.</p></div> <hr> <h2 id="how-to-use-it-on-a-form"><a href="#how-to-use-it-on-a-form" class="header-anchor">#</a> How to use it on a form?</h2> <p>Let's say that you have a form with a <strong>state</strong> field to pick:</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>al<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Alabama<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ak<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Alaska<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>With CityState gem, change your code to this:</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token constant">CS</span><span class="token punctuation">.</span>states<span class="token punctuation">(</span><span class="token symbol">:us</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token operator">|</span>key<span class="token punctuation">,</span> value<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> key <span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> value <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="how-to-populate-cities-when-the-state-is-changed"><a href="#how-to-populate-cities-when-the-state-is-changed" class="header-anchor">#</a> How to populate cities when the state is changed?</h2> <p>Do it with Ajax:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># routes.rb</span>
get <span class="token string">'cities/:state'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">'application#cities'</span>
</code></pre></div><div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># application_controller.rb</span>
<span class="token keyword">def</span> <span class="token method-definition"><span class="token function">cities</span></span>
  render json<span class="token punctuation">:</span> <span class="token constant">CS</span><span class="token punctuation">.</span>cities<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:state</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token symbol">:us</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_json
<span class="token keyword">end</span>
</code></pre></div><div class="language-erb extra-class"><pre class="language-erb"><code><span class="token comment">&lt;!-- _form.html.erb --&gt;</span>
<span class="token comment">&lt;!-- State list --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token constant">CS</span><span class="token punctuation">.</span>states<span class="token punctuation">(</span><span class="token symbol">:us</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>key<span class="token punctuation">,</span> value<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> key <span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> value <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- City list --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>city<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- AJAX that loads &quot;City&quot; according to the selected state --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'select[name=&quot;state&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> input_state <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/cities/'</span> <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    input_state<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> opt <span class="token operator">=</span> <span class="token string">'&lt;option value='</span><span class="token operator">+</span> i <span class="token operator">+</span><span class="token string">'&gt;'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'&lt;/option&gt;'</span><span class="token punctuation">;</span>
      input_state<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/45.b0f0f5f2.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
