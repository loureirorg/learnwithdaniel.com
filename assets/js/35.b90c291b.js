(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{367:function(a,t,e){a.exports=e.p+"assets/img/msx.c4c70356.png"},510:function(a,t,e){"use strict";e.r(t);var s=e(21),o=Object(s.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("I will show how to host your own email domain (or domains) for free!")]),a._v(" "),s("p",[a._v("Yeah, you can have your own "),s("code",[a._v("pam@domain.com")]),a._v(" instead of "),s("code",[a._v("pam1985b@gmail.com")]),a._v(", which is more professional, and for free.\n")]),a._v(" "),s("p",[a._v("But calm down. This is a complex solution based on email redirection, using a free Gmail account behind the scenes. Yeah, it's a poor man's solution, but your email address will look professional. Your customers will never know that you are using Gmail (or whatever provider) behind the scenes.")]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("This tutorial doesn't show how to implement a full POP3/SMTP service. It's only an MTA server with redirection. But it's a good enough solution for small sites.")])]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("If you want to host your own email domain because you are afraid of NSA or something like that, "),s("s",[a._v("I recommend to you a psychiatrist")]),a._v(" "),s("s",[a._v("I recommend stop selling drugs,")]),a._v(" this won't be a good solution because it uses Gmail as an SMTP/POP3 server, which means they will have access to your emails. But the process to implement a full email server is pretty similar to this, only a bit more complicated (you will have to install "),s("code",[a._v("postfix")]),a._v(" and "),s("code",[a._v("courier")]),a._v(" too).")])]),a._v(" "),s("h2",{attrs:{id:"ingredients"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ingredients"}},[a._v("#")]),a._v(" Ingredients")]),a._v(" "),s("ul",[s("li",[a._v("Shell access to a server that will manage this;")]),a._v(" "),s("li",[a._v("Access to the domain's DNS management;")]),a._v(" "),s("li",[a._v("A generic email account (eg. "),s("code",[a._v("bob2387@google.com")]),a._v(");")])]),a._v(" "),s("h2",{attrs:{id:"our-recipe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#our-recipe"}},[a._v("#")]),a._v(" Our recipe")]),a._v(" "),s("h3",{attrs:{id:"_1-let-s-implement-3-email-addresses"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-let-s-implement-3-email-addresses"}},[a._v("#")]),a._v(" 1. Let's implement 3 email addresses")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("bob@example.com:")]),a._v(" Alias to "),s("code",[a._v("bob.example@gmail.com")]),a._v(";")]),a._v(" "),s("li",[s("strong",[a._v("pam@example.com:")]),a._v(" Alias to "),s("code",[a._v("pam.example@gmail.com")]),a._v(";")]),a._v(" "),s("li",[s("strong",[a._v("info@example.com:")]),a._v(" Alias to "),s("code",[a._v("bob.example@gmail.com")]),a._v(" + "),s("code",[a._v("pam.example@gmail.com")]),a._v(";")])]),a._v(" "),s("h3",{attrs:{id:"_2-create-your-dns-records"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-create-your-dns-records"}},[a._v("#")]),a._v(" 2. Create your DNS records")]),a._v(" "),s("ul",[s("li",[a._v("Create an "),s("code",[a._v("A")]),a._v(" record named "),s("code",[a._v("mail")]),a._v(" pointing to your server IP;")]),a._v(" "),s("li",[a._v("Create an "),s("code",[a._v("MX")]),a._v(" record named "),s("code",[a._v("example.com")]),a._v(" pointing to "),s("code",[a._v("mail.example.com")]),a._v(" (replace "),s("code",[a._v("example.com")]),a._v(" with your actual domain, without "),s("code",[a._v("www")]),a._v(")")])]),a._v(" "),s("p",[a._v("Example on CloudFlare interface:\n"),s("img",{attrs:{src:e(367)+"#wide",alt:"Example on CloudFlare interface"}})]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("After that, you can test your MX record with this tool: "),s("a",{attrs:{href:"https://mxtoolbox.com/SuperTool.aspx",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://mxtoolbox.com/SuperTool.aspx"),s("OutboundLink")],1)])]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("On "),s("strong",[a._v("MX Toolbox")]),a._v(', "SMTP Test" will give an error because we haven\'t configurated Exim4 yet. We will fix this through this tutorial.')])]),a._v(" "),s("h3",{attrs:{id:"_3-install-exim4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-install-exim4"}},[a._v("#")]),a._v(" 3. Install "),s("code",[a._v("Exim4")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" exim4 exim4-base exim4-config exim4-daemon-heavy\n")])])]),s("h3",{attrs:{id:"_4-re-create-the-configuration-files"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-re-create-the-configuration-files"}},[a._v("#")]),a._v(" 4. Re-create the configuration files")]),a._v(" "),s("p",[a._v("Run:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" dpkg-reconfigure exim4-config\n")])])]),s("ul",[s("li",[a._v("On "),s("code",[a._v("interfaces")]),a._v(", you need to leave it empty.")]),a._v(" "),s("li",[a._v("On "),s("code",[a._v("split files?")]),a._v(", you need to answer "),s("code",[a._v("YES!!!")]),a._v(".")])]),a._v(" "),s("h3",{attrs:{id:"_5-edit-etc-exim4-update-exim4-conf-conf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-edit-etc-exim4-update-exim4-conf-conf"}},[a._v("#")]),a._v(" 5. Edit "),s("code",[a._v("/etc/exim4/update-exim4.conf.conf")])]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_eximconfig_configtype")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'internet'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_other_hostnames")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'example.com;example2.com'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_local_interfaces")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("''")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_readhost")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("''")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_relay_domains")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("''")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_minimaldns")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'false'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_relay_nets")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("''")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_smarthost")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("''")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CFILEMODE")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'644'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_use_split_config")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'false'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_hide_mailname")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("''")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_mailname_in_oh")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'true'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("dc_localdelivery")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v("'mail_spool'")]),a._v("\n")])])]),s("p",[s("code",[a._v("dc_other_hostnames")]),a._v(" is optional. You can leave it blank or even incomplete, but if you want to fill it:")]),a._v(" "),s("ul",[s("li",[a._v("Replace "),s("code",[a._v("example.com")]),a._v(" and "),s("code",[a._v("example2.com")]),a._v(" with your actual domains.")]),a._v(" "),s("li",[a._v("If you have just one domain, use something like: "),s("code",[a._v("dc_other_hostnames='example.com'")])])]),a._v(" "),s("h3",{attrs:{id:"_6-remove-the-override-configuration-file-if-existing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-remove-the-override-configuration-file-if-existing"}},[a._v("#")]),a._v(" 6. Remove the override configuration file, if existing")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" /etc/exim4/exim4.conf\n")])])]),s("h3",{attrs:{id:"_7-re-create-the-auto-generated-config-file-var-lib-exim4-config-autogenerated"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-re-create-the-auto-generated-config-file-var-lib-exim4-config-autogenerated"}},[a._v("#")]),a._v(" 7. Re-create the auto-generated config file ("),s("code",[a._v("/var/lib/exim4/config.autogenerated")]),a._v(")")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" update-exim4.conf\n")])])]),s("h3",{attrs:{id:"_8-create-a-folder-etc-valias"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-create-a-folder-etc-valias"}},[a._v("#")]),a._v(" 8. Create a folder "),s("code",[a._v("/etc/valias")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /etc/valias\n")])])]),s("h3",{attrs:{id:"_9-create-a-configuration-file-for-each-domain-in-etc-valiases"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-create-a-configuration-file-for-each-domain-in-etc-valiases"}},[a._v("#")]),a._v(" 9. Create a configuration file for each domain in "),s("code",[a._v("/etc/valiases")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nano")]),a._v(" /etc/valiases/example.com\n")])])]),s("p",[a._v("Contents:")]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[a._v("bob: bob.example@gmail.com\npam: pam.example@gmail.com\ninfo: bob.example@gmail.com, pam.example@gmail.com\n*: bob.example@gmail.com, pam.example@gmail.com\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("Notice the "),s("code",[a._v("*")]),a._v(" at the last line. It's a catch-all email address. It's optional and it means that any email that doesn't match the above rules will end up there. For example, "),s("code",[a._v("test@example.com")]),a._v(" will be sent to "),s("code",[a._v("bob")]),a._v(" and "),s("code",[a._v("pam")]),a._v(" in this configuration.")])]),a._v(" "),s("h3",{attrs:{id:"_10-edit-etc-exim4-conf-d-main-01-exim4-config-listmacrosdefs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-edit-etc-exim4-conf-d-main-01-exim4-config-listmacrosdefs"}},[a._v("#")]),a._v(" 10. Edit "),s("code",[a._v("/etc/exim4/conf.d/main/01_exim4-config_listmacrosdefs")])]),a._v(" "),s("p",[a._v("Set the virtual aliases directory ("),s("code",[a._v("/etc/valiases")]),a._v("):")]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#domainlist local_domains = MAIN_LOCAL_DOMAINS")]),a._v("\ndomainlist local_domains "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" @:localhost:dsearch;/var/mail/virtual:dsearch;/etc/valiases")]),a._v("\n")])])]),s("h3",{attrs:{id:"_11-edit-etc-exim4-conf-d-router-350-exim4-config-vdom-aliases"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-edit-etc-exim4-conf-d-router-350-exim4-config-vdom-aliases"}},[a._v("#")]),a._v(" 11. Edit "),s("code",[a._v("/etc/exim4/conf.d/router/350_exim4-config_vdom_aliases")])]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[a._v("vdom_aliases:\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("      driver")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" redirect")]),a._v("\n      allow_defer\n      allow_fail\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("      domains")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" dsearch;/etc/valiases")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("      data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" ${expand:${lookup{$local_part}lsearch*@{/etc/valiases/$domain}}}")]),a._v("\n      retry_use_local_part\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("      pipe_transport")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" address_pipe")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("      file_transport")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" address_file")]),a._v("\n      no_more\n")])])]),s("h3",{attrs:{id:"_12-add-your-domains-to-etc-hosts-optional-just-for-speed-sake"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-add-your-domains-to-etc-hosts-optional-just-for-speed-sake"}},[a._v("#")]),a._v(" 12. Add your domains to "),s("code",[a._v("/etc/hosts")]),a._v(" (OPTIONAL – just for speed sake)")]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[a._v("127.0.1.1       example.com\n127.0.1.1       example2.com\n")])])]),s("h3",{attrs:{id:"_13-re-start-exim4-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_13-re-start-exim4-service"}},[a._v("#")]),a._v(" 13. Re-start "),s("code",[a._v("exim4")]),a._v(" service")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" /etc/init.d/exim4 restart\n")])])]),s("h3",{attrs:{id:"_14-test-if-it-s-all-working"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_14-test-if-it-s-all-working"}},[a._v("#")]),a._v(" 14. Test if it's all working")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" exim -bt -d-resolver bob@example.com\n")])])]),s("p",[a._v("See logs with:")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" -f /var/log/exim4/mainlog\n")])])]),s("p",[a._v("Check with an external tool:\n"),s("a",{attrs:{href:"https://mxtoolbox.com/SuperTool.aspx",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://mxtoolbox.com/SuperTool.aspx"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_15-tls-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_15-tls-optional"}},[a._v("#")]),a._v(" 15. TLS (optional)")]),a._v(" "),s("p",[a._v("If you want to enable TLS, you can use this tutorial and a "),s("code",[a._v("CAcert.org")]),a._v(" SSL cert for free:\n"),s("a",{attrs:{href:"https://github.com/Exim/exim/wiki/EximServerSslCertificate",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/Exim/exim/wiki/EximServerSslCertificate"),s("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=o.exports}}]);