<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DRYing a Settings API form | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/38.aef7ef02.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/25.53994f14.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/33.6be9bedc.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/37.fe79cc5b.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/45.b0f0f5f2.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/54.e1e107ff.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/6.70c0bce3.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WordPress
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    PHP
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WP Plugin Development
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>DRYing a Settings API form</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Jun 21, 2019</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    5 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>Forms created with the Settings API usually have lots of repetitive code. To improve this, let's see a simple technique to write forms with reduced code,  inspired by WooCommerce.
</p> <p>The idea is simple: we put all the form fields in an array. Then, we loop this array and call <code>add_settings_field()</code> dynamically.</p> <p>We can save this code as an external file and re-use it to all our pages, just changing the array input.</p> <h2 id="the-original-code"><a href="#the-original-code" class="header-anchor">#</a> The original code</h2> <p>Here's the current code we developed in the previous article:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Section</span>
  <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token string single-quoted-string">'my-section'</span><span class="token punctuation">;</span>
  <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'My Section'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
  <span class="token variable">$page_id</span>         <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 1</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 2</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allow option to be saved.</span>
  <span class="token function">register_setting</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'sanitize_callback'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my_validation_callback'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="drying-the-code"><a href="#drying-the-code" class="header-anchor">#</a> DRYing the code</h2> <p>Let's DRY (Don't Repeat Yourself) this code.</p> <p>First, put all the fields in an array:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$fields</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My field 1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My field 2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
<span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Field 1'</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-section'</span><span class="token punctuation">,</span> <span class="token variable">$fields</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Field 2'</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-section'</span><span class="token punctuation">,</span> <span class="token variable">$fields</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Test it on the browser. It produces the same result as before.</p> <p>For dynamic sections, let's refactor what we wrote and have an array of sections. Let's add another section and a few more fields. Put fields as sub-arrays of each section:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$sections</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'id'</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-section-1'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'title'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Section Title 1'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'fields'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 1'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 2'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'id'</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-section-2'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'title'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Section Title 2'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'fields'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 3'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 4'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Loop through this array calling Settings API functions dynamically:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$page_id</span>             <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span>
  <span class="token variable">$option_key</span>          <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">;</span>
  <span class="token variable">$validation_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_validation_callback'</span><span class="token punctuation">;</span>

  <span class="token comment">// Form structure.</span>
  <span class="token variable">$sections</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'id'</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-section-1'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'title'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Section Title 1'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'fields'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 1'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 2'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'id'</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-section-2'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'title'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Section Title 2'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'fields'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 3'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 4'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// Loop sections.</span>
  <span class="token keyword">foreach</span> <span class="token punctuation">(</span> <span class="token variable">$sections</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$section</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Add Section.</span>
    <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token variable">$section</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token variable">$section</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Loop fields.</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span> <span class="token variable">$section</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fields'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$field</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// Add field.</span>
      <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
      <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token variable">$option_key</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Allow Settings API to save option. */</span>
  <span class="token function">register_setting</span><span class="token punctuation">(</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$option_key</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'sanitize_callback'</span> <span class="token operator">=&gt;</span> <span class="token variable">$validation_callback</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Check on the browser:</p> <p><img src="data:image/png;base64,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" alt="Complete Form"></p> <h2 id="making-this-code-re-usable"><a href="#making-this-code-re-usable" class="header-anchor">#</a> Making this code re-usable</h2> <p>Let's move the loop and the render to an external file (<code>settings-utils.php</code>):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// settings-utils.php</span>

<span class="token keyword">function</span> <span class="token function">my_field_render</span><span class="token punctuation">(</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$option_key</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$field_id</span>   <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$type</span>       <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$name</span>       <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$option_key</span><span class="token punctuation">}</span></span>[<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$field_id</span><span class="token punctuation">}</span></span>]&quot;</span><span class="token punctuation">;</span>

  <span class="token variable">$option</span>     <span class="token operator">=</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token variable">$option_key</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$value</span>      <span class="token operator">=</span> <span class="token variable">$option</span><span class="token punctuation">[</span> <span class="token variable">$field_id</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token variable">$is_textarea</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'textarea'</span> <span class="token operator">===</span> <span class="token variable">$type</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$is_textarea</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;textarea name='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>'&gt;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">}</span></span>&lt;/textarea&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;input type='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$type</span><span class="token punctuation">}</span></span>' name='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>' value='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">}</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">define_settings_form</span><span class="token punctuation">(</span><span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$option_key</span><span class="token punctuation">,</span> <span class="token variable">$sections</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Loop sections.</span>
  <span class="token keyword">foreach</span> <span class="token punctuation">(</span> <span class="token variable">$sections</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=&gt;</span> <span class="token variable">$section</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Add Section.</span>
    <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token variable">$section</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token variable">$section</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Loop fields.</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span> <span class="token variable">$section</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fields'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$field</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// Add field.</span>
      <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
      <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token variable">$option_key</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Allow Settings API to save option. */</span>
  <span class="token function">register_setting</span><span class="token punctuation">(</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$option_key</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'sanitize_callback'</span> <span class="token operator">=&gt;</span> <span class="token variable">$validation_callback</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Notice I added a textarea support to <code>my_field_render()</code>. Add other types that you need for your forms. Examples: select, radio, a custom element.</p> <p>You can also add dynamic attributes like CSS classes and any additional information to make your inputs.</p> <p>Now, you can easily create forms by just defining an array:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
required_once <span class="token string double-quoted-string">&quot;settings-utils.php&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$page_id</span>    <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span>
  <span class="token variable">$option_key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">;</span>

  <span class="token comment">// Form structure.</span>
  <span class="token variable">$sections</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'id'</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-section-1'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'title'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Section Title 1'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'fields'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 1'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 2'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'id'</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-section-2'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'title'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Section Title 2'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'fields'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 3'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span> <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'field4'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'My Field 4'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">define_settings_form</span><span class="token punctuation">(</span><span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$option_key</span><span class="token punctuation">,</span> <span class="token variable">$sections</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>This code is way smaller and simpler to read than before DRYing it.</p></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/38.aef7ef02.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
