<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Settings API in depth with PsySH | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/6.70c0bce3.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/25.53994f14.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/33.6be9bedc.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/37.fe79cc5b.js"><link rel="prefetch" href="/assets/js/38.aef7ef02.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/45.b0f0f5f2.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/54.e1e107ff.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WordPress
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    PHP
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WP Plugin Development
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>Settings API in depth with PsySH</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Jun 20, 2019</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    23 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>In this article, let's discover the Settings API in depth. Let's learn how to use PsySH to check how WordPress works under the hood.
</p> <h2 id="the-settings-api"><a href="#the-settings-api" class="header-anchor">#</a> The <code>Settings API</code></h2> <p>The page we created in the previous article works well, but there's a lot of manual work involved: we have to deal with nonces, permissions, manually save options, process the <code>$_POST</code> parameters.</p> <p>Also, our plugin page doesn't look exactly like the core settings pages. It's similar, but something is off.</p> <p>A core page:
<img src="/assets/img/wp-core-page-cut.3a59b76b.png" alt="A core settings page"></p> <p>Our page:
<img src="/assets/img/lwd-wordpress-layout-off.02f557cc.png" alt="Our plugin page"></p> <p>There's no space between the label and the input, labels are not bold, etc. That's because a lot of <code>div</code> wrappers and classes are missing in our layout.</p> <p>We can manually set them, but that's a lot of work. Also, it wouldn't be future-proof: what if WordPress changes its official layout?! We would end up with an outdated look.</p> <p>Luckily, WordPress has a library to wrap all this boring, manual, repetitive stuff and let us focus on what matters: our plugin's logic.</p> <p>This library is the <code>Settings API</code>.</p> <h2 id="we-build-forms-programmatically"><a href="#we-build-forms-programmatically" class="header-anchor">#</a> We build forms programmatically</h2> <p>So far, we have been building our forms using pure HTML. With the Settings API, we don't work with HTML. We create forms programmatically with PHP functions.</p> <p>Instead of writing the form contents with HTML, we call a function to render the form. This function calls sub-functions to render the sections, which call sub-sub-functions to render fields.</p> <h2 id="settings-api-is-for-forms"><a href="#settings-api-is-for-forms" class="header-anchor">#</a> Settings API is for Forms</h2> <p>The Settings API is <strong>not used to build a whole page</strong>, just the form contents of a page.</p> <p>We still have to write HTML code for the page itself. Only the form, which is the core part of a admin page, is built with the Settings API.</p> <h2 id="rendering-a-form"><a href="#rendering-a-form" class="header-anchor">#</a> Rendering a Form</h2> <p>One of the most incredible things about the Settings API is that we can access any form from any plugin using this library.</p> <p>We can create a plugin to extend other plugins' settings pages and add fields and sections to them.</p> <p>To render a form, use the function <code>do_settings_sections( $id )</code>. The <code>id</code> is a unique identifier of the form. A good practice is to use the <strong>menu's slug</strong>.</p> <p>For example, I have the plugin &quot;<em>Code Snippets</em>&quot; installed locally. Let's replace our form's contents with their form:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'code-snippets'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Reload the page:</p> <p><img src="/assets/img/wp-render-other-plugins-form.a9b556f9.png" alt="Our page but with code-snippets form on it"></p> <p>It's our page, but with Code Snippets' form contents on it.</p> <p>Cool, but how can we create our forms instead of using others'? That's what we are going to learn next: how to create our own fields and sections.</p> <h2 id="fields-and-sections"><a href="#fields-and-sections" class="header-anchor">#</a> Fields and Sections</h2> <p>A page made with the Settings API has two elements: <code>fields</code> and <code>sections</code>.</p> <p>We worked with them manually before:</p> <ul><li><strong>Field</strong> is a HTML input: <code>textarea</code>, <code>checkbox</code>, <code>radio</code>, <code>select</code>, <code>input</code>.</li> <li><strong>Section</strong> is a sub-title for a group of fields: <code>&lt;h2&gt;</code>.</li></ul> <p>On the Settings API, each field belongs to a section. If you don't want to display a section, label it blank. But your field must be in a section.</p> <p>Let's see all this in action with PsySH.</p> <h2 id="loading-admin-functions-on-psysh"><a href="#loading-admin-functions-on-psysh" class="header-anchor">#</a> Loading admin functions on PsySH</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>psysh
</code></pre></div><p>We have WordPress loaded, but not with the admin libraries. The Settings API is an admin library.</p> <p>Let's load them and also trigger the <code>admin_init</code> action, to load plugins:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Load admin functions.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">require</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp-admin/includes/admin.php'</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token number">1</span>

<span class="token comment">// Trigger `admin_init` to load plugins.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">do_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_init'</span> <span class="token punctuation">)</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT option_value FROM wp_options WHERE option_name = '_site_transient_update_core' LIMIT 1&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT option_value FROM wp_options WHERE option_name = '_site_transient_update_plugins' LIMIT 1&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT option_value FROM wp_options WHERE option_name = '_site_transient_update_themes' LIMIT 1&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT * FROM wp_posts WHERE ID = 3 LIMIT 1&quot;</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Put these two commands in the <code>.psysh</code> file to avoid typing them on each PsySH session.</p></div> <h2 id="sections-and-fields"><a href="#sections-and-fields" class="header-anchor">#</a> Sections and Fields</h2> <p>Now that we have PsySH loaded, let's define our first section.</p> <p>Let's check the current sections loaded on Settings API. They are stored in the global <code>$wp_settings_sections</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">global</span> <span class="token variable">$wp_settings_sections</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$wp_settings_sections</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>We have no sections defined yet, and thus no forms.</p> <p>There's no function to define a form explicitly. We only have functions to define sections and fields. Forms are implicitly defined when we define a section.</p> <p>If any plugin made with the Settings API were active, it would appear here. I disabled the &quot;Code Snippet&quot; plugin previously used as an example. That's why we don't see it.</p> <p>Now let's define our first section with <code>add_settings_section(...)</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Add Section</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token string single-quoted-string">'my-section'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'My Section'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$page_id</span>         <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>The <code>section_id</code> is a unique identifier. It can be anything. I usually use the title as if was a variable. It doesn't need to be globally unique. It just needs to be unique within your form. In other words, if another plugin has the same section id, there won't be an issue.</p> <p>The <code>render_callback</code> is used for custom HTML rendering. When <code>false</code>, it prints the title as a <code>&lt;h2&gt;</code>.</p> <p>Now that we added the section, let's check the global definitions:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Sections</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$wp_settings_sections</span>
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
     <span class="token string double-quoted-string">&quot;my-menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
       <span class="token string double-quoted-string">&quot;my-section&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
         <span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;my-section&quot;</span><span class="token punctuation">,</span>
         <span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;My Section&quot;</span><span class="token punctuation">,</span>
         <span class="token string double-quoted-string">&quot;callback&quot;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>
       <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">]</span>
</code></pre></div><p>We can see the Settings API created a <code>my-menu</code> key for our form. Inside of it, we have a list of sections: <code>my-section</code>.</p> <p>Let's render our form:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Render form</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span>
<span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>My Section<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>Nice! We rendered our first form with the Settings API.</p> <p>Let's now add a field for our section with <code>add_settings_field(...)</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Add Field</span>
<span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span>
<span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span>
<span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token class-name type-declaration">false</span>
<span class="token variable">$page_id</span>         <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span>
<span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>The <code>field_id</code> just needs to be unique within your form. Do not use two fields with the same id, even if they are on different sections. Two forms with the same id are allowed, though.</p> <p>Let's render our form again:</p> <div class="language-html extra-class"><pre class="language-html"><code>&gt;&gt;&gt; do_settings_sections( 'my-menu' )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>My Section<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-table<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>presentation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>warning</span><span class="token punctuation">&gt;</span></span>PHP Warning:  call_user_func() expects parameter 1 to be a valid callback, no array or string given in /wp-admin/includes/template.php on line 1737<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>warning</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>⏎
=&gt; null
</code></pre></div><p>Hmmm. We got an error here. That's because we need to set a render for fields. There's no standard render as we have for the sections.</p> <p>Let's set a simple render for the field:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">my_render_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>   <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;input type=&quot;text&quot; /&gt;'</span><span class="token punctuation">;</span>
<span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>And re-add the field:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_render_input'</span>
<span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span> <span class="token punctuation">)</span>
</code></pre></div><p>To make sure we didn't create a second field with the same id, let's check the field definitions with <code>$wp_settings_fields</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">global</span> <span class="token variable">$wp_settings_fields</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$wp_settings_fields</span>
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
     <span class="token string double-quoted-string">&quot;my-menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
       <span class="token string double-quoted-string">&quot;my-section&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
         <span class="token string double-quoted-string">&quot;field1&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
           <span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;field1&quot;</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;My field 1&quot;</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;callback&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;my_render_input&quot;</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;args&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">]</span>
</code></pre></div><p>Great. We didn't duplicate the field, and the Settings API updated the field with our new render. The Settings API is smart enough to update, instead of adding, a field when the id is already there.</p> <p>Let's render our form:</p> <div class="language-html extra-class"><pre class="language-html"><code>&gt;&gt;&gt; do_settings_sections( 'my-menu' )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>My Section<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-table<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>presentation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>⏎
</code></pre></div><p>That's perfect, no errors. Let's add a second field:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Add Field #2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>And render it:</p> <div class="language-html extra-class"><pre class="language-html"><code>&gt;&gt;&gt; do_settings_sections( 'my-menu' )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>My Section<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-table<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>presentation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>⏎
</code></pre></div><p>It's all looking good, but the fields have no <code>name</code> attribute. Without it, it is not possible to save data.</p> <h3 id="the-name-attribute"><a href="#the-name-attribute" class="header-anchor">#</a> The <code>name</code> attribute</h3> <p>We need to set a name attribute to save our fields. But what would be the right name to use? What name the Settings API expects us to put on an input field?</p> <p>The Settings API is not strict about how we store data. We still need to write all the steps for storing and loading data manually: we need to call the <code>get_option</code> to print the input's values, we need to set which <code>$_POST</code> arguments will be saved, we need to write code to generate the field name.</p> <p>We control the whole process. It is not different from what we had done before when we created a full settings page without the Settings API. We can store each field on its own option, which is terrible for performance. Or we can use an associative array to store all our form fields in a single database record, which is what we are going to do.</p> <p>For this tutorial, let's save our fields in an option named <code>my-menu-option</code>. That means our fields will be named <code>my-menu-option[field1]</code> and <code>my-menu-option[field2]</code>. Usually, I would use just the page id, <code>my-menu</code>, with no <code>-option</code>. But to clarify that we can use any name we want, let's name it slightly differently.</p> <p>Let's print our field names using one render for each field:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Renders</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">my_render_input1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>   <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;input type=&quot;text&quot; name=&quot;my-menu-option[field1]&quot; /&gt;'</span><span class="token punctuation">;</span>
<span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">my_render_input2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>   <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;input type=&quot;text&quot; name=&quot;my-menu-option[field2]&quot; /&gt;'</span><span class="token punctuation">;</span>
<span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token comment">// Field 1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_render_input1'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>

<span class="token comment">// Field 2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_render_input2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>Let's render it:</p> <div class="language-html extra-class"><pre class="language-html"><code>&gt;&gt;&gt; do_settings_sections( 'my-menu' )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>My Section<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-table<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>presentation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu-option[field1]<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu-option[field2]<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>⏎
</code></pre></div><p>That works, but what if we have dozens of fields? Should we create a custom render for each of them?</p> <p>Luckily, there's a better way. We can pass arguments to the render and use them to generate the fields dynamically.</p> <h2 id="rendering-fields-dynamically"><a href="#rendering-fields-dynamically" class="header-anchor">#</a> Rendering fields dynamically</h2> <p>The <code>add_settings_field()</code> function accepts an extra argument that is sent to the callback.</p> <p>Let's use it to pass all the information necessary to build the HTML element:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Render with arguments.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">my_field_render</span><span class="token punctuation">(</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>   <span class="token variable">$option_key</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">...</span>   <span class="token variable">$field_id</span>   <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">...</span>   <span class="token variable">$name</span>       <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$option_key</span><span class="token punctuation">}</span></span>[<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$field_id</span><span class="token punctuation">}</span></span>]&quot;</span><span class="token punctuation">;</span>
<span class="token operator">...</span>   <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;input type='text' name='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token comment">// Field 1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_render'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>

<span class="token comment">// Field 2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_render'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span>
<span class="token operator">=&gt;</span> <span class="token constant">null</span>
</code></pre></div><p>Let's check it:</p> <div class="language-html extra-class"><pre class="language-html"><code>&gt;&gt;&gt; do_settings_sections( 'my-menu' )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>My Section<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-table<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>presentation<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>my-menu-option[field1]<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>My field 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>my-menu-option[field2]<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>⏎
</code></pre></div><p>The form is rendering perfectly.</p> <p>You can use the arguments to pass the field type (select, textarea, etc), CSS classes and ids, and any other information to make your inputs.</p> <p>Let's check how this looks on WordPress.</p> <h2 id="rendering-on-wordpress"><a href="#rendering-on-wordpress" class="header-anchor">#</a> Rendering on WordPress</h2> <p>First, let's change our form rendering function:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Our Settings API code has to be called during the admin initialization, with the <code>admin_init</code> action:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_init'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_menu_define_form'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Let's fill the function with our code:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_field_render</span><span class="token punctuation">(</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$option_key</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$field_id</span>   <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$name</span>       <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$option_key</span><span class="token punctuation">}</span></span>[<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$field_id</span><span class="token punctuation">}</span></span>]&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;input type='text' name='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Section</span>
  <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token string single-quoted-string">'my-section'</span><span class="token punctuation">;</span>
  <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'My Section'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
  <span class="token variable">$page_id</span>         <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 1</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 2</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_init'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_menu_define_form'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Reload the page to see the results:</p> <p><img src="/assets/img/wp-settings-final.69da36bd.png" alt="Form with two fields"></p> <p>It looks good. But what about saving? Pressing the &quot;Save&quot; button does nothing.</p> <h2 id="storing"><a href="#storing" class="header-anchor">#</a> Storing</h2> <p>The Settings API saves the data for us, but we need to:</p> <ul><li>Send the form data to <code>options.php</code>;</li> <li>Render security fields with <code>settings_fields( $page_id )</code>;</li></ul> <p>Let's check the <code>settings_fields()</code> on PsySH:</p> <div class="language-html extra-class"><pre class="language-html"><code>&gt;&gt;&gt; settings_fields( 'my-menu' )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>hidden<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>option_page<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>my-menu<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>update<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_wpnonce<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_wpnonce<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2f273a7345<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_wp_http_referer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>⏎
</code></pre></div><p>The function is generating a nonce and a referer (used for security purposes). And it is also telling <code>options.php</code> our page id and that we are updating a settings page.</p> <p>Now, let's put all of this in our code:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>options.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_fields</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Let's check if it works when we press the save button:</p> <p><img src="data:image/png;base64,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" alt="Error message when saving"></p> <p>It didn't work. We got this &quot;<strong>Error: Options page my-menu not found in the allowed options list.</strong>&quot;.</p> <p>The Settings API has a mechanism to prevent mass-assignment attacks.</p> <p>Any registered user has access to the admin panel. Imagine a plugin with a setting page for regular users. In this scenario, an attacker can access the settings page and inject fields on the HTML to overwrite options like <code>admin_email</code>, and get full control of the website.</p> <p>Because of this security feature, our plugin needs to explicitly tell the Settings API which options are allowed to be stored.</p> <p>We do this with <code>register_setting( $page_id, $option_key )</code>:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Section</span>
  <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token string single-quoted-string">'my-section'</span><span class="token punctuation">;</span>
  <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'My Section'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
  <span class="token variable">$page_id</span>         <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 1</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 2</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allow option to be saved.</span>
  <span class="token function">register_setting</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>A <code>setting</code> is a synonym for <code>option</code>, but used in the Settings API context.
In our example, our page's <code>setting</code> is <code>my-menu-option</code>.</p></div> <p>Testing again:</p> <p><img src="/assets/img/wp-settings-success-without-retrieving.69fab963.png" alt="Success message, but without retrieving data"></p> <p>It works, and now we just need to retrieve the saved data.</p> <h2 id="retrieving"><a href="#retrieving" class="header-anchor">#</a> Retrieving</h2> <p>Data is being saved, but not being displayed. Let's fix it with <code>get_option( $option_key )</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_field_render</span><span class="token punctuation">(</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$option_key</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$field_id</span>   <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$name</span>       <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$option_key</span><span class="token punctuation">}</span></span>[<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$field_id</span><span class="token punctuation">}</span></span>]&quot;</span><span class="token punctuation">;</span>

  <span class="token variable">$option</span>     <span class="token operator">=</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token variable">$option_key</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$value</span>      <span class="token operator">=</span> <span class="token variable">$option</span><span class="token punctuation">[</span> <span class="token variable">$field_id</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;input type='text' name='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>' value='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">}</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Even though we call <code>get_option()</code> multiple times for the same key, it will only read the database once, thanks to the Options API cache. So, no need to worry about performance.</p> <p>Let's try to save:</p> <p><img src="/assets/img/wp-settings-saved.c4813ecc.png" alt="Settings sucessfully saved"></p> <p>Great. Our settings have been properly saved. Even when you reload the page, the data is still there.</p> <h3 id="escape-the-output"><a href="#escape-the-output" class="header-anchor">#</a> Escape the output</h3> <p>Always escape inputs before output. For HTML attributes, use the <code>esc_attr( $text )</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">esc_attr</span><span class="token punctuation">(</span> <span class="token variable">$option</span><span class="token punctuation">[</span> <span class="token variable">$field_id</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="input-normalization-validation-sanitization-filtering-and-escaping"><a href="#input-normalization-validation-sanitization-filtering-and-escaping" class="header-anchor">#</a> Input Normalization, Validation, Sanitization, Filtering, and Escaping</h2> <p>The Settings API has a unique mechanism for validations, but first, let's understand its concepts.</p> <p>Key differences:</p> <ul><li><strong>Input Normalization:</strong> Change the input to have a standard form. Examples: trimming values, typecasting, lowercase a value, etc. Even though it changes the value, the changes have no semantical impact. The data is different, but the information remains the same. <code>&quot; John Snow &quot;</code> and <code>&quot;John Snow&quot;</code> are the same, <code>&quot;yes&quot;</code> and <code>true</code> are the same, <code>My@EMail.com</code> and <code>my@email.com</code> are the same, the phone number <code>(401) 1020-3040</code> and <code>40110203040</code> are the same. This process is also called &quot;<strong>Canonicalization</strong>&quot;;</li> <li><strong>Input Validation:</strong> Check if the value is valid. Examples: check if the field is required, check if the email has an invalid format, check if the birth date is in the future, check if age is less than 18, check if the name has just one character;</li> <li><strong>Input Sanitization:</strong> Removes illegal characters and makes risky data safe. Examples: escaping the value <code>O'Brien</code> to avoid breaking SQL, escaping strings to avoid SQL injections. There are two main competing sanitization types: filtering and escaping. Use one or the other;</li></ul> <p>The order should be: <code>normalization &gt; validation &gt; sanitization</code>.</p> <h3 id="sanitization-types-filtering-vs-escaping"><a href="#sanitization-types-filtering-vs-escaping" class="header-anchor">#</a> Sanitization types: Filtering vs. Escaping</h3> <p><code>Escaping</code> is when we encode the input, so the characters don't get mistaken as commands. For example, encode <code>O'Brien</code> to <code>O\'Brien</code> when escaping for SQL. Or encoding <code>&lt;3</code> to <code>&amp;#60;3</code> for HTML, or <code>Me &amp; You</code> to <code>Me%20%26%20You</code> for URLs. Escaping can also be called <code>encoding</code>.</p> <p><code>Filtering</code> is to remove illegal characters. For example, <code>O'Brien</code> becomes <code>OBrien</code>, <code>&lt;3</code> becomes <code>3</code>, <code>Me &amp; You</code> becomes <code>Me You</code>.</p> <p>Always <strong>prefer escaping</strong> for your sanitizations. Do not just remove characters before saving them, adulterating their contents. That's bad practice.</p> <p>When used for validation, filtering frequently prevents authorized input, like <code>O'Brien</code>, where the <code>'</code> character is entirely legitimate. When used for sanitization, it saves the wrong data. <strong>Do not rely on filtering</strong> for validations nor sanitizations.</p> <h3 id="settings-api"><a href="#settings-api" class="header-anchor">#</a> Settings API</h3> <p><strong>Sanitization:</strong> A good thing about the Settings API is that we don't need to worry about risky inputs when saving with it. The Settings API uses the Options API, which automatically escapes inputs before saving them, as we have seen before. We still need to escape the value before printing to prevent XSS attacks, but not here, during saving, which is what this section is about.</p> <p>When <strong>validating inputs</strong>, you need to write code to cancel the whole saving and return an error message when invalid input is detected.</p> <p><strong>Input normalization</strong>, like trimming strings and converting <code>&quot;yes&quot;</code> to <code>true</code>, happens before validation, but they are optional.</p> <h3 id="code"><a href="#code" class="header-anchor">#</a> Code</h3> <p>Let's say we have an email input, and we want to validate it.</p> <p>The 3rd argument of <code>register_setting()</code> accepts a callback to check and change the inputs before saving. The callback should return the value that will be saved:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">register_setting</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'sanitize_callback'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my_validation_callback'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_validation_callback</span><span class="token punctuation">(</span> <span class="token variable">$option</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Strips out illegal characters from email address.</span>
  <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sanitize_email</span><span class="token punctuation">(</span> <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token variable">$option</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this example, if the user tries to save <code>my#@email.com</code>, it will save it as <code>my@email.com</code>. That works, but it is lazy and a wrong way to deal with inputs. That's filtering sanitization.</p> <p>We shouldn't adulterate the inputs. If there's an illegal email character, we should return an error and not save the input. If there's a risky character, we should encode it, not remove it.</p> <p>Despite its name, <code>sanitize_callback</code> can and should be used for validation and normalization. The trick is to return the original value when invalid. Use <code>add_settings_error( $setting, $code, $message, $type = 'error' )</code> to throw errors for invalid inputs:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_validation_callback</span><span class="token punctuation">(</span> <span class="token variable">$option</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** The original value. */</span>
  <span class="token variable">$option_name</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">;</span>
  <span class="token variable">$original_option</span> <span class="token operator">=</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token variable">$option_name</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/** Normalization. */</span>
  <span class="token variable">$normalized</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token function">strtolower</span><span class="token punctuation">(</span> <span class="token function">trim</span><span class="token punctuation">(</span> <span class="token variable">$option</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'email'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/** Validation. */</span>
  <span class="token variable">$is_valid_email</span> <span class="token operator">=</span> <span class="token function">is_email</span><span class="token punctuation">(</span> <span class="token variable">$normalized</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'email'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token variable">$is_valid_email</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">add_settings_error</span><span class="token punctuation">(</span> <span class="token variable">$option_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'invalid-email'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Email is not valid!'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** When has errors, return the original state (do not save). */</span>
  <span class="token variable">$has_errors</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">!==</span> <span class="token function">count</span><span class="token punctuation">(</span> <span class="token function">get_settings_errors</span><span class="token punctuation">(</span> <span class="token variable">$option_name</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_errors</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$original_option</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Save normalized inputs when there's no errors.  */</span>
  <span class="token keyword">return</span> <span class="token variable">$normalized</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To test it, change the <code>field1</code> name to <code>email</code> and click to save. If you type an invalid email, you will get this error:</p> <p><img src="data:image/png;base64,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" alt="Field 1 is not valid error"></p> <h2 id="displaying-error-and-success-messages"><a href="#displaying-error-and-success-messages" class="header-anchor">#</a> Displaying Error and Success messages</h2> <p>Our page is in the &quot;Settings&quot; menu:</p> <p><img src="/assets/img/wp-menu-in-settings.98ed6013.png" alt="Close-up of our menu item in settings menu"></p> <p>Because of it, success and error messages are displayed automatically:</p> <p><img src="/assets/img/wp-error-message.542c4734.png" alt="Error message on our page after saving"></p> <p>But let's move our menu to the &quot;Tools&quot; menu:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_plugin_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$page_title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'My Plugin Page'</span><span class="token punctuation">;</span>
  <span class="token variable">$menu_title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'My Plugin'</span><span class="token punctuation">;</span>
  <span class="token variable">$capability</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'manage_options'</span><span class="token punctuation">;</span> <span class="token comment">// Only users that can manage options can access this menu item.</span>
  <span class="token variable">$menu_slug</span>  <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span> <span class="token comment">// unique identifier.</span>
  <span class="token variable">$callback</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'my_menu_html'</span><span class="token punctuation">;</span>
  <span class="token function">add_management_page</span><span class="token punctuation">(</span> <span class="token variable">$page_title</span><span class="token punctuation">,</span> <span class="token variable">$menu_title</span><span class="token punctuation">,</span> <span class="token variable">$capability</span><span class="token punctuation">,</span> <span class="token variable">$menu_slug</span><span class="token punctuation">,</span> <span class="token variable">$callback</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div> <p><img src="/assets/img/wp-menu-in-tools.d582b89f.png" alt="Close-up of our menu item in tools menu"></p> <p>Now, when you click to save, no message is displayed. No success or errors.</p> <p><img src="/assets/img/wp-no-messages.6f590ba5.png" alt="No messages on our page after saving"></p> <p>Outside &quot;Settings&quot; menu, we need to manually display the messages with <code>settings_errors( $page_id )</code>:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// show error/success messages</span>
  <span class="token function">settings_errors</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>options.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_fields</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Reload the page and press to save:</p> <p><img src="/assets/img/wp-error-message.542c4734.png" alt="Error message on our page after saving"></p> <p>The error message works now, but what about the success message? Type a valid email and click to save:</p> <p><img src="/assets/img/wp-no-messages.6f590ba5.png" alt="No messages on our page after saving"></p> <p>No success message.</p> <p>To show a success message, we need to call <code>add_settings_error(...)</code> and pass <code>'success'</code> as the <code>$type</code> argument.</p> <p>You could place this call in the validation callback, after checking that there are no errors:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/** Display success and save normalized inputs.  */</span>
<span class="token function">add_settings_error</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'success'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Settings Saved'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'updated'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$normalized</span><span class="token punctuation">;</span>
</code></pre></div><p>That will work:</p> <p><img src="/assets/img/wp-settings-saved-success.a5de690a.png" alt="Success message after saving"></p> <p>But what if something goes wrong in the <code>options.php</code>? For example,  if there's a problem with the database. Or, let's say, an external plugin intercepts the input and throws an error.</p> <p>In this case, we would incorrectly set the &quot;Success&quot; message (the error happens after the sanitization callback) and it would be displayed to the user.</p> <p>Because of this, the best place to put this code is just before displaying the messages, in the form:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check if data has been properly saved.</span>
  <span class="token variable">$has_been_saved</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'settings-updated'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_been_saved</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">add_settings_error</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'success'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Settings Saved'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'updated'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Display error/success messages</span>
  <span class="token function">settings_errors</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>options.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_fields</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>If <code>options.php</code> can successfully save the input and there are no error messages, it sets the <code>settings-updated</code> argument into the URL. Use it to detect success:</p> <p><img src="/assets/img/wp-settings-saved-success.a5de690a.png" alt="Success message after saving"></p> <h2 id="security-checking-for-permissions"><a href="#security-checking-for-permissions" class="header-anchor">#</a> Security: Checking for permissions</h2> <p>The Settings API checks for intention (nonces) and performs other security checks for us, thanks to the <code>settings_field()</code> function.</p> <p>WordPress checks if we have permission to open the menu page thanks to the <code>$capability</code> argument on <code>add_*_page()</code>.</p> <p>But despite these automatic checks, it is a good practice to double-check the permissions when rendering the page:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check user capabilities</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** ... */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Use the same capability defined on <code>add_*_page()</code>.</p> <h2 id="full-code"><a href="#full-code" class="header-anchor">#</a> Full code</h2> <p>Here's the full code we've developed:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check user capabilities</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Check if data has been properly saved.</span>
  <span class="token variable">$has_been_saved</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'settings-updated'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_been_saved</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">add_settings_error</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'success'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Settings Saved'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'updated'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Display error/success messages</span>
  <span class="token function">settings_errors</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Page title. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>options.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

      <span class="token comment">&lt;!-- Security fields. --&gt;</span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_fields</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>

      <span class="token comment">&lt;!-- Settings API renders the form contents. --&gt;</span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>

      <span class="token comment">&lt;!-- Submit button. --&gt;</span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">my_field_render</span><span class="token punctuation">(</span> <span class="token variable">$args</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$option_key</span> <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$field_id</span>   <span class="token operator">=</span> <span class="token variable">$args</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$name</span>       <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$option_key</span><span class="token punctuation">}</span></span>[<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$field_id</span><span class="token punctuation">}</span></span>]&quot;</span><span class="token punctuation">;</span>

  <span class="token variable">$option</span>     <span class="token operator">=</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token variable">$option_key</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$value</span>      <span class="token operator">=</span> <span class="token variable">$option</span><span class="token punctuation">[</span> <span class="token variable">$field_id</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;input type='text' name='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$name</span><span class="token punctuation">}</span></span>' value='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">}</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">my_validation_callback</span><span class="token punctuation">(</span> <span class="token variable">$option</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** The original value. */</span>
  <span class="token variable">$option_name</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">;</span>
  <span class="token variable">$original_option</span> <span class="token operator">=</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token variable">$option_name</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/** Normalization. */</span>
  <span class="token variable">$normalized</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token function">strtolower</span><span class="token punctuation">(</span> <span class="token function">trim</span><span class="token punctuation">(</span> <span class="token variable">$option</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'email'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/** Validation. */</span>
  <span class="token variable">$is_valid_email</span> <span class="token operator">=</span> <span class="token function">is_email</span><span class="token punctuation">(</span> <span class="token variable">$normalized</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'email'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token variable">$is_valid_email</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">add_settings_error</span><span class="token punctuation">(</span> <span class="token variable">$option_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'invalid-email'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Email is not valid!'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** When has errors, return the original state (do not save). */</span>
  <span class="token variable">$has_errors</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">!==</span> <span class="token function">count</span><span class="token punctuation">(</span> <span class="token function">get_settings_errors</span><span class="token punctuation">(</span> <span class="token variable">$option_name</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_errors</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$original_option</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Save normalized inputs when there's no errors.  */</span>
  <span class="token keyword">return</span> <span class="token variable">$normalized</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">my_menu_define_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Section</span>
  <span class="token variable">$section_id</span>      <span class="token operator">=</span> <span class="token string single-quoted-string">'my-section'</span><span class="token punctuation">;</span>
  <span class="token variable">$section_title</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'My Section'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
  <span class="token variable">$page_id</span>         <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_section</span><span class="token punctuation">(</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$section_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 1</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 1'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Field 2</span>
  <span class="token variable">$field_id</span>        <span class="token operator">=</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">;</span>
  <span class="token variable">$field_title</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'My field 2'</span><span class="token punctuation">;</span>
  <span class="token variable">$render_callback</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_field_render'</span><span class="token punctuation">;</span>
  <span class="token variable">$extra_args</span>      <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field_id'</span> <span class="token operator">=&gt;</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'option_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my-menu-option'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">add_settings_field</span><span class="token punctuation">(</span> <span class="token variable">$field_id</span><span class="token punctuation">,</span> <span class="token variable">$field_title</span><span class="token punctuation">,</span> <span class="token variable">$render_callback</span><span class="token punctuation">,</span> <span class="token variable">$page_id</span><span class="token punctuation">,</span> <span class="token variable">$section_id</span><span class="token punctuation">,</span> <span class="token variable">$extra_args</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allow option to be saved.</span>
  <span class="token function">register_setting</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-menu-option'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'sanitize_callback'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my_validation_callback'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">my_plugin_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$page_title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'My Plugin Page'</span><span class="token punctuation">;</span>
  <span class="token variable">$menu_title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'My Plugin'</span><span class="token punctuation">;</span>
  <span class="token variable">$capability</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'manage_options'</span><span class="token punctuation">;</span> <span class="token comment">// Only users that can manage options can access this menu item.</span>
  <span class="token variable">$menu_slug</span>  <span class="token operator">=</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">;</span> <span class="token comment">// unique identifier.</span>
  <span class="token variable">$callback</span>   <span class="token operator">=</span> <span class="token string single-quoted-string">'my_menu_html'</span><span class="token punctuation">;</span>
  <span class="token function">add_management_page</span><span class="token punctuation">(</span> <span class="token variable">$page_title</span><span class="token punctuation">,</span> <span class="token variable">$menu_title</span><span class="token punctuation">,</span> <span class="token variable">$capability</span><span class="token punctuation">,</span> <span class="token variable">$menu_slug</span><span class="token punctuation">,</span> <span class="token variable">$callback</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_init'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_menu_define_form'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_menu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_plugin_menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><hr> <p>And that's it. Now, you know how to create a settings page using the Settings API.</p> <p>But that was a lot of coding for a simple page. Let's see how to DRY this code in the following article.</p></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/6.70c0bce3.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
