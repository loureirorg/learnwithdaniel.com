<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP Processing on WordPress | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/54.e1e107ff.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/25.53994f14.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/33.6be9bedc.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/37.fe79cc5b.js"><link rel="prefetch" href="/assets/js/38.aef7ef02.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/45.b0f0f5f2.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/6.70c0bce3.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WordPress
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    PHP
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WP Plugin Development
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>HTTP Processing on WordPress</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Jun 26, 2019</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    7 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>Being able to receive and process requests is one of the most important things for a plugin. Let's see how to do it on WordPress.
</p> <p>Sometimes you need extra buttons on your admin page, that once pressed, do some server-side action.</p> <p>For example, let's say you want a &quot;<em>Hello World</em>&quot; button that echoes a &quot;<em>Hello World</em>&quot; on screen.</p> <p>You have these options:</p> <table><thead><tr><th style="text-align:center;">Method</th> <th style="text-align:center;">AJAX</th> <th style="text-align:center;">NON-AJAX</th> <th style="text-align:center;">Front-End or Admin?</th></tr></thead> <tbody><tr><td style="text-align:center;">admin_post_*</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">Admin only</td></tr> <tr><td style="text-align:center;">admin_post_nopriv_*</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">Both</td></tr> <tr><td style="text-align:center;">Ajax API</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">NO</td> <td style="text-align:center;">Both</td></tr> <tr><td style="text-align:center;">REST API</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">NO</td> <td style="text-align:center;">Both</td></tr> <tr><td style="text-align:center;">Router method</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">YES</td> <td style="text-align:center;">Both</td></tr></tbody></table> <hr> <p>For <strong>non-Ajax</strong>, use the dynamic hook <code>admin_post_{$plugin_action}</code>.</p> <p>For <strong>Ajax</strong>, you have two standard options: <code>Ajax API</code> and <code>REST API</code>. Learn more about them <a href="/2019/07/wordpress-ajax-rest-api/">here</a>. You can also use <code>admin_post_*</code> for Ajax, but it is not standard.</p> <p>Alternatively, as a workaround, you can implement a &quot;<strong>router</strong>&quot; (Ajax and non-Ajax), which consists of intercept every single HTTP request and call our custom method if the URL and parameters match our route. But save this method for scenarios where you can't use the other solutions (it is not a standard way to communicate with the server).</p> <h3 id="_9-1-admin-post-plugin-action"><a href="#_9-1-admin-post-plugin-action" class="header-anchor">#</a> 9.1. <code>admin_post_{$plugin_action}</code></h3> <p>Add this code to the constructor:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Fired on authenticated POST /wp-admin/admin-post.php?action=myplugin_hello. */</span>
  <span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_post_myplugin_hello'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello_callback'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This calls <code>hello_callback()</code> on an authenticated <code>POST /wp-admin/admin-post.php?action=myplugin_hello</code> requests.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><strong>Note 1:</strong> In order to avoid conflict with other plugins, add your slug to the action name. In other words, <strong>prefer &quot;myplugin_hello&quot; instead of &quot;hello&quot;</strong>.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><strong>Note 2:</strong> This should be implemented in the <code>__construct()</code> constructor. It won't work if you implement it on &quot;admin_menu&quot;, &quot;load-{$menu}, or any other specific action.</p></div> <p>Then, implement the button and its form:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">&lt;!-- my-plugin/my-plugin.php --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin-post.php&gt;
  &lt;input type=<span class="token punctuation">&quot;</span></span><span class="token attr-name">hidden&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myplugin_hello<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'Hello World'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>And the callback:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">hello_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** my code.. */</span>

  <span class="token comment">/** Return to the last page. */</span>
  <span class="token function">wp_redirect</span><span class="token punctuation">(</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_REFERER'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="adding-security-nonces-and-permissions"><a href="#adding-security-nonces-and-permissions" class="header-anchor">#</a> Adding security - Nonces, and permissions</h3> <p>&quot;admin_post&quot; automatically checks if the user is authenticated on the admin dashboard and nothing else. It is recommended to also check for intention (nonce):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">&lt;!-- my-plugin/my-plugin.php --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin-post.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$nonce</span> <span class="token operator">=</span> <span class="token function">wp_create_nonce</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'_wpnonce'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_wpnonce<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">esc_attr</span><span class="token punctuation">(</span> <span class="token variable">$nonce</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myplugin_hello<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'Hello World'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">hello_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Check nonce. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wpnonce'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wpnonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_wpnonce'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** my code... */</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can use the helper <code>settings_fields( $action )</code> to generate the <code>_wpnonce</code> input.</p></div> <p><strong>Normal users can also access the admin dashboard</strong>, so you <strong>MUST</strong> check for permissions - that's a critical item:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">hello_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Check permissions. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Check nonce. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wpnonce'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wpnonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_wpnonce'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>I recommend using more restrictive permission than the generic <code>manage_options</code>. Check the best permission for you here:
<a href="https://wordpress.org/support/article/roles-and-capabilities" target="_blank" rel="noopener noreferrer">https://wordpress.org/support/article/roles-and-capabilities<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="_9-3-replacing-the-save-button-with-your-custom-one"><a href="#_9-3-replacing-the-save-button-with-your-custom-one" class="header-anchor">#</a> 9.3. Replacing the &quot;Save&quot; button with your custom one</h3> <p>You can follow these instructions if you want a single button that saves and does other actions.</p> <p>First, set the constructor (same code as before):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Fired on authenticated POST /wp-admin/admin-post.php?action=myplugin_hello. */</span>
  <span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_post_myplugin_hello'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello_callback'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Adapt the default form: set <code>admin-post.php</code> as the form URL, pass the &quot;action&quot; as a hidden input, change the button name (optional):</p> <div class="language-php extra-class"><pre class="language-php"><code>// my-plugin/my-plugin.php
public function my_plugin_options() { ?&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Your plugin page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin-post.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_fields</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myplugin_hello<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'Save and Print &quot;Hello&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>On the callback, you must manually save the inputs:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">hello_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Check permissions. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Check nonce. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wpnonce'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wpnonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'_wpnonce'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Save options. */</span>
  <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'opt1'</span><span class="token punctuation">,</span> <span class="token function">wp_unslash</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'opt1'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'opt2'</span><span class="token punctuation">,</span> <span class="token function">wp_unslash</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'opt2'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/** ... */</span>

  <span class="token comment">/** my code... */</span>

  <span class="token comment">/** Return to the last page. */</span>
  <span class="token function">wp_redirect</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'_wp_http_referer'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-the-router-method-an-alternative-to-admin-post"><a href="#_10-the-router-method-an-alternative-to-admin-post" class="header-anchor">#</a> 10.  The Router method (an alternative to &quot;admin_post&quot;)</h2> <p>The idea here is to intercept all HTTP requests (by hooking on the <code>admin_init</code> action) and filter the ones directed to your endpoint.</p> <p>In this example, let's create the &quot;<em>Hello World</em>&quot; button using a router.</p> <p>The URL will be <code>/wp-admin/admin.php?page=my-plugin&amp;action=hello-world</code>. But it can be anything (ex. &quot;/hello/world&quot;, if the installation supports pretty URLs):</p> <p>First, let's add a callback called on every admin request:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Executed on ALL admin requests. */</span>
  <span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'admin_init'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'router_callback'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can use this method for non-admin calls, just replace <code>admin_init</code> with <code>init</code>.</p></div> <p>Then, let's filter the requests that are directed to us (on the callback):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token comment">/** Filter the requests to our plugin. */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">router_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Our requests have &quot;page&quot; AND &quot;action&quot; set up. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Let's filter the &quot;page&quot; argument. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-plugin'</span> <span class="token operator">!==</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** THE PROCESSING. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'hello-world'</span> <span class="token operator">===</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now, let's replace the standard &quot;Save&quot; button with our &quot;Hello&quot; button:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">my_plugin_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Your plugin page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin.php?page=my-plugin&amp;action=hello-world<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">settings_fields</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">do_settings_sections</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>If you want to save the options, call <code>update_option( $field, $value )</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/** Filter the requests to our plugin. */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">router_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Our requests have &quot;page&quot; AND &quot;action&quot; set up. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Let's filter the &quot;page&quot; argument. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-plugin'</span> <span class="token operator">!==</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** THE PROCESSING. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'hello-world'</span> <span class="token operator">===</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Save options. */</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my_field1'</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'my_field1'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my_field2'</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">'my_field2'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** Process it. */</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Additionally, you can filter by the HTTP verb (GET, POST, etc.) in the callback to avoid conflicts.</p> <p>You don't need to replace the &quot;Save&quot; button. You can have both. If you decide to keep the save button, be aware that you can't have nested &quot;&lt;form&gt;&quot; tags. In this case, add the other forms next to the main form (not inside). Then, your custom submits button can be inside the main form, outside its form, but it should have the <code>form=my-other-form</code> attribute.</p> <p>Now, let's add security by checking <strong>permissions</strong> and <strong>nonces</strong>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/** Filter the requests to our plugin. */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">router_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Our requests have &quot;page&quot; AND &quot;action&quot; set up. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Let's filter the &quot;page&quot; argument. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-plugin'</span> <span class="token operator">!==</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Check permissions. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">is_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Check nonce. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'my_nonce'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'my_nonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello-world'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** THE PROCESSING. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string single-quoted-string">'hello-world'</span> <span class="token operator">===</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, generate the nonce (pass it either in the URL or as a hidden input):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$nonce</span> <span class="token operator">=</span> <span class="token function">wp_create_nonce</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'hello-world'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin.php?page=my-plugin&amp;action=hello-world&amp;my_nonce=<span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$nonce</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/54.e1e107ff.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
