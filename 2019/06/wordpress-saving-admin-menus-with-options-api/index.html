<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Saving Admin Forms with Options API | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/37.fe79cc5b.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/25.53994f14.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/33.6be9bedc.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/38.aef7ef02.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/45.b0f0f5f2.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/54.e1e107ff.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/6.70c0bce3.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WordPress
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    PHP
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WP Plugin Development
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>Saving Admin Forms with Options API</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Jun 18, 2019</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    7 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>In the last article, we saw how to build a custom admin menu. Let's see how to use the Options API to save our form data.
</p> <h2 id="summary-options-api"><a href="#summary-options-api" class="header-anchor">#</a> Summary: Options API</h2> <ul><li>Store with <code>update_option( $key, $value )</code>;</li> <li>Load with <code>get_option( $key )</code>;</li></ul> <h2 id="using-options-api-in-our-form"><a href="#using-options-api-in-our-form" class="header-anchor">#</a> Using Options API in our form</h2> <p>Thanks to the Options API, we can easily store and load data. Let's use it to save our form:</p> <div class="language-php extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Submit button has been pressed (button name is `submit`).</span>
  <span class="token variable">$has_submitted</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_submitted</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field1'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Page HTML.</span>
  <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field1'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><strong>Test it:</strong> Reload the page, type something, and save. Your changes will stay permanent.</p> <p><img src="/assets/img/lwd-menu-item-saved.a1aed1dd.png" alt="Input with data saved"></p> <h2 id="grouping-options-for-optimization"><a href="#grouping-options-for-optimization" class="header-anchor">#</a> Grouping options for optimization</h2> <p>Let's say we have many options in our page:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Submit button has been pressed (button name is `submit`).</span>
  <span class="token variable">$has_submitted</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_submitted</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field1'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field2'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field3'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field3'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field4'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field4'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field5'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field5'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Page HTML.</span>
  <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field1'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field2'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field3'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field4'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field5'</span> <span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>That works, but the performance isn't optimal. We are triggering five queries to load the page - and five others to update it. Imagine if we have dozens of options. Besides the big amount of queries, that will clutter the database.</p> <p>A simple solution is to have them all in a single associative array instead of having multiple options.</p> <p>Let's see this in action on PsySH:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// BAD: Three values stored as individual options.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my value 1'</span> <span class="token punctuation">)</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SHOW FULL COLUMNS FROM `wp_options`&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;UPDATE `wp_options` SET `option_value` = 'my value 1' WHERE `option_name` = 'field1'&quot;</span>
<span class="token operator">=&gt;</span> <span class="token constant boolean">true</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field2'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'another value'</span> <span class="token punctuation">)</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT option_value FROM wp_options WHERE option_name = 'field2' LIMIT 1&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;INSERT INTO `wp_options` (`option_name`, `option_value`, `autoload`) VALUES ('field2', 'another value', 'yes') ON DUPLICATE KEY UPDATE `option_name` = VALUES(`option_name`), `option_value` = VALUES(`option_value`), `autoload` = VALUES(`autoload`)&quot;</span>
<span class="token operator">=&gt;</span> <span class="token constant boolean">true</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'field3'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'the third value'</span> <span class="token punctuation">)</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT option_value FROM wp_options WHERE option_name = 'field3' LIMIT 1&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;INSERT INTO `wp_options` (`option_name`, `option_value`, `autoload`) VALUES ('field3', 'the third value', 'yes') ON DUPLICATE KEY UPDATE `option_name` = VALUES(`option_name`), `option_value` = VALUES(`option_value`), `autoload` = VALUES(`autoload`)&quot;</span>
<span class="token operator">=&gt;</span> <span class="token constant boolean">true</span>

<span class="token comment">// GOOD: Three values stored as one single option.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token variable">$my_values</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'field1'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my value 1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'field2'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'another value'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'field3'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'the third value'</span> <span class="token punctuation">]</span>
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
     <span class="token string double-quoted-string">&quot;field1&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;my value 1&quot;</span><span class="token punctuation">,</span>
     <span class="token string double-quoted-string">&quot;field2&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;another value&quot;</span><span class="token punctuation">,</span>
     <span class="token string double-quoted-string">&quot;field3&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;the third value&quot;</span><span class="token punctuation">,</span>
   <span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my_values'</span><span class="token punctuation">,</span> <span class="token variable">$my_values</span> <span class="token punctuation">)</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;SELECT option_value FROM wp_options WHERE option_name = 'my_values' LIMIT 1&quot;</span>
<span class="token operator">^</span> <span class="token string double-quoted-string">&quot;INSERT INTO `wp_options` (`option_name`, `option_value`, `autoload`) VALUES ('my_values', 'a:3:{s:6:\&quot;field1\&quot;;s:10:\&quot;my value 1\&quot;;s:6:\&quot;field2\&quot;;s:13:\&quot;another value\&quot;;s:6:\&quot;field3\&quot;;s:15:\&quot;the third value\&quot;;}', 'yes') ON DUPLICATE KEY UPDATE `option_name` = VALUES(`option_name`), `option_value` = VALUES(`option_value`), `autoload` = VALUES(`autoload`)&quot;</span>
<span class="token operator">=&gt;</span> <span class="token constant boolean">true</span>
</code></pre></div><p>With associative arrays, we always end up having two queries, no matter how many fields we are storing. If we have 10 fields we will have 2 queries. If we have 1000 fields, we will have 2 queries.</p> <p>With individual options, if we have 10 fields we will have 20 queries. If we have 1000 fields, we will have 2000 queries!</p> <p>In other words, is <code>O(2)</code> vs <code>O(2n)</code>. So, always prefer to group your fields into associative arrays, aka an <code>options group</code>.</p> <p>Now, let's refactor our code to store fields as an associative array instead of individual options:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Submit button has been pressed (button name is `submit`).</span>
  <span class="token variable">$has_submitted</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$has_submitted</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">update_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'my-menu'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// All fields in an associative array.</span>
  <span class="token variable">$option</span> <span class="token operator">=</span> <span class="token function">get_option</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-menu'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Page HTML.</span>
  <span class="token delimiter important">?&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token function">get_admin_page_title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter important">?&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu[field1]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field1'</span><span class="token punctuation">]</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu[field2]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field2'</span><span class="token punctuation">]</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu[field3]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field3'</span><span class="token punctuation">]</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu[field4]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field4'</span><span class="token punctuation">]</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-menu[field5]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$option</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field5'</span><span class="token punctuation">]</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">submit_button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>That's way better. Also, grouping options is recommended by the official documents when saving a settings page.</p> <h2 id="_5-security-permissions-and-intention"><a href="#_5-security-permissions-and-intention" class="header-anchor">#</a> 5. Security: Permissions and Intention</h2> <p>As any user can access the admin panel, it's a good idea to check if the user has the permissions to access the page.</p> <p>We did this when we created the menu, but it is a good practice to double-check it when rendering the page's HTML.</p> <p>You can use the <code>current_user_can( $capability )</code> method for this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Check permissions. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** ... */</span>
</code></pre></div><p>Use the same permission you used for the menu item (on <code>add_options_page(...)</code>).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can find a list of all permissions here:
<a href="https://wordpress.org/support/article/roles-and-capabilities" target="_blank" rel="noopener noreferrer">https://wordpress.org/support/article/roles-and-capabilities<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="clickjack-attacks-intention-and-nonces"><a href="#clickjack-attacks-intention-and-nonces" class="header-anchor">#</a> Clickjack attacks, intention and nonces</h3> <p>Imagine an attacker sends you an email with a button that says &quot;Click here for a free aPhone&quot;.</p> <p>Of course you will click. Who doesn't want a free aPhone?! However, the button is a direct link to your user management page on WordPress. The link creates a new admin user with the attacker's email address. You try to click on the &quot;Free aPhone&quot; button, but instead, you create an admin user for the attacker.</p> <p>In this scenario, a permission check won't save you, as you, the victim, have the right permissions.</p> <p>This type of attack is know as <code>Clickjacking Attack</code>. To prevent it, we need to check for the user intention. We need to know if the user intended to perform the action.</p> <p>Luckily, WordPress provides us with a simple but effective way to deal with this: <code>nonces</code>.</p> <p>A nonce is a random token added to your form that by matching on the action, we guarantee the data came from the form and not from somewhere else.</p> <p>We generate a nonce with <code>wp_create_nonce( $action )</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$nonce</span> <span class="token operator">=</span> <span class="token function">wp_create_nonce</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-awesome-form'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-nonce-field<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$nonce</span> <span class="token delimiter important">?&gt;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Or even better, use the helper <code>wp_nonce_field( $action, $field_name )</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">wp_nonce_field</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-awesome-form'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-nonce-field'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
</code></pre></div><p>Then, check with the permissions:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Check nonce. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'my-nonce-field'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'my-nonce-field'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-awesome-form'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Check permissions. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** ... */</span>
</code></pre></div><p>The <code>my-awesome-form</code> string can be anything you want, as long as you use the same string on both ends (form and validation).</p> <p>The nonce guarantees your intention, that you reached the action through the form and not by some random link.</p> <h3 id="final-code"><a href="#final-code" class="header-anchor">#</a> Final code</h3> <p>Instead of <code>wp_verify_nonce()</code>, use <code>check_admin_referer()</code> when checking nonces on the admin side. It adds extra validations.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_menu_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Check nonce. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">check_admin_referer</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-awesome-form'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-nonce-field'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** Check permissions. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'manage_options'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/** ... */</span>
</code></pre></div><hr> <p>The page we created so far works good, but there's a lot of manual work involved: we have to deal with nonces, permissions, manually save options, process the <code>$_POST</code> parameters.</p> <p>Luckily, WordPress has a library to wrap all this boring, manual, repetitive stuff and let us focus on what it matters: our plugin's logic. Let's see it in the next article.</p></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/37.fe79cc5b.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
