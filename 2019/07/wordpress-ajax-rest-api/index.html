<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ajax API and REST API | Learn with Daniel - A learner diary</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon-128.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="A learner diary">
    
    <link rel="preload" href="/assets/css/0.styles.e0c1612b.css" as="style"><link rel="preload" href="/assets/js/app.5632ea00.js" as="script"><link rel="preload" href="/assets/js/3.9e1cc85f.js" as="script"><link rel="preload" href="/assets/js/25.53994f14.js" as="script"><link rel="preload" href="/assets/js/22.2ffb8c95.js" as="script"><link rel="prefetch" href="/assets/js/10.ab7cb67b.js"><link rel="prefetch" href="/assets/js/11.5242956c.js"><link rel="prefetch" href="/assets/js/12.59c1b827.js"><link rel="prefetch" href="/assets/js/13.eb4c0cc0.js"><link rel="prefetch" href="/assets/js/14.cd6385da.js"><link rel="prefetch" href="/assets/js/15.f6ed5cf0.js"><link rel="prefetch" href="/assets/js/16.60e48bf7.js"><link rel="prefetch" href="/assets/js/17.6ade2139.js"><link rel="prefetch" href="/assets/js/18.f3523bb9.js"><link rel="prefetch" href="/assets/js/19.0cd9be83.js"><link rel="prefetch" href="/assets/js/20.74e5d0bb.js"><link rel="prefetch" href="/assets/js/21.057bc373.js"><link rel="prefetch" href="/assets/js/23.45611473.js"><link rel="prefetch" href="/assets/js/24.2c5aaad4.js"><link rel="prefetch" href="/assets/js/26.4b88dd5e.js"><link rel="prefetch" href="/assets/js/27.33da5e65.js"><link rel="prefetch" href="/assets/js/28.e1bc1897.js"><link rel="prefetch" href="/assets/js/29.41a44f48.js"><link rel="prefetch" href="/assets/js/30.b52a01e3.js"><link rel="prefetch" href="/assets/js/31.32e50696.js"><link rel="prefetch" href="/assets/js/32.9870be67.js"><link rel="prefetch" href="/assets/js/33.6be9bedc.js"><link rel="prefetch" href="/assets/js/34.95333d7a.js"><link rel="prefetch" href="/assets/js/35.b90c291b.js"><link rel="prefetch" href="/assets/js/36.853d11aa.js"><link rel="prefetch" href="/assets/js/37.fe79cc5b.js"><link rel="prefetch" href="/assets/js/38.aef7ef02.js"><link rel="prefetch" href="/assets/js/39.dca7aa67.js"><link rel="prefetch" href="/assets/js/4.37520176.js"><link rel="prefetch" href="/assets/js/40.d659d938.js"><link rel="prefetch" href="/assets/js/41.83aeacc5.js"><link rel="prefetch" href="/assets/js/42.610c5aca.js"><link rel="prefetch" href="/assets/js/43.e9222b3a.js"><link rel="prefetch" href="/assets/js/44.9858f816.js"><link rel="prefetch" href="/assets/js/45.b0f0f5f2.js"><link rel="prefetch" href="/assets/js/46.492b33ea.js"><link rel="prefetch" href="/assets/js/47.07c3328b.js"><link rel="prefetch" href="/assets/js/48.b2d7476f.js"><link rel="prefetch" href="/assets/js/49.9fd583ed.js"><link rel="prefetch" href="/assets/js/5.b259d54e.js"><link rel="prefetch" href="/assets/js/50.9e6ef79d.js"><link rel="prefetch" href="/assets/js/51.8c3776f7.js"><link rel="prefetch" href="/assets/js/52.92a4b980.js"><link rel="prefetch" href="/assets/js/53.3e72d3bc.js"><link rel="prefetch" href="/assets/js/54.e1e107ff.js"><link rel="prefetch" href="/assets/js/55.418768d6.js"><link rel="prefetch" href="/assets/js/56.95ca3ac0.js"><link rel="prefetch" href="/assets/js/57.ea7fb933.js"><link rel="prefetch" href="/assets/js/58.40c5610c.js"><link rel="prefetch" href="/assets/js/59.5af9d54f.js"><link rel="prefetch" href="/assets/js/6.70c0bce3.js"><link rel="prefetch" href="/assets/js/60.0c66c22f.js"><link rel="prefetch" href="/assets/js/61.05b88817.js"><link rel="prefetch" href="/assets/js/62.483e5481.js"><link rel="prefetch" href="/assets/js/63.6ab28e82.js"><link rel="prefetch" href="/assets/js/7.8d26dacd.js"><link rel="prefetch" href="/assets/js/8.6beb7cbb.js"><link rel="prefetch" href="/assets/js/9.5015eb07.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92df942c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e0c1612b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="dark:bg-gray-1000 bg-white dark:text-sepia text-gray-900" data-v-335698aa><header class="border-b-4 dark:border-green-700 border-primary" data-v-335698aa><div class="container mx-auto flex h-20 px-6 items-center"><a href="/" class="dark:text-green-700 text-primary text-3xl router-link-active">
            Learn With Daniel
        </a></div></header> <div class="container mx-auto px-6 md:px-16 py-8 max-w-screen-md" data-v-335698aa><div class="py-8 md:py-16" data-v-335698aa><div data-v-335698aa><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WordPress
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    PHP
                </span><span class="dark:bg-gray-800 bg-gray-100 px-3 py-1 mx-1 rounded-full uppercase text-xs font-medium dark:text-green-700 tracking-wider" data-v-335698aa>
                    WP Plugin Development
                </span></div> <h1 class="dark:text-green-500 text-4xl md:text-6xl py-6" data-v-335698aa>Ajax API and REST API</h1> <p class="author text-sm" data-v-335698aa>
                by <span class="text-base font-bold" data-v-335698aa>Daniel Loureiro</span>
                on <time class="mr-3" data-v-335698aa>Jul 3, 2019</time> <span class="reading-time text-xs uppercase py-4 block md:inline-block md:py-9" data-v-335698aa><vp-icon size="1.5em" name="clock-best" class="inline-block" data-v-335698aa></vp-icon>
                    8 min read
                </span></p></div> <div class="post-wrap text-xl leading-10 pb-8" data-v-335698aa><div class="content__default" data-v-335698aa><p>WordPress has two APIs to implement Ajax: <code>Ajax API</code> and <code>REST API</code>. Let's see how to use them.
</p> <ul><li><p>The <code>Ajax API</code> was the only option for many years. It consists of sending a POST request to <code>/wp-admin/admin-ajax.php</code>. The &quot;admin&quot; in the URL is misleading as it can be used either in the admin or in the front-end.</p></li> <li><p>The <code>REST API</code> is more recent. WordPress released this API on version 4.4, and it can be considered a more modern approach for Ajax requests. It also allows for custom endpoints.</p></li></ul> <p>Some people consider the REST API more complex and hard to understand than the Ajax API, but it is up to you to choose one over the other. In the end, they both do the same things.</p> <hr> <h2 id="_1-ajax-api"><a href="#_1-ajax-api" class="header-anchor">#</a> 1. Ajax API</h2> <p>To implement an Ajax endpoint, use <code>wp_ajax_*</code> (for authenticated access) or <code>wp_ajax_nopriv_*</code> (for unauthenticated access):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/** Ajax route. */</span>
<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp_ajax_my_action'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_action_callback'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp_ajax_nopriv_my_action'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_action_callback'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** Ajax callback. */</span>
<span class="token keyword">function</span> <span class="token function">my_action_callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Dump $_REQUEST as JSON. */</span>
  <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">wp_die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Go to the blog main page (ex. <code>http://localhost:3000/</code>), open the browser console (Ctrl+F12) and execute this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** Ajax call. */</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/wp-admin/admin-ajax.php'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token string">'action=my_action'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">json</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span> <span class="token string">'error:'</span><span class="token punctuation">,</span> error <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It will return the dump of the arguments we sent:</p> <div class="language-js extra-class"><pre class="language-js"><code>Object <span class="token punctuation">{</span> action<span class="token operator">:</span> <span class="token string">&quot;my_action&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><div class="custom-block success"><p>Done!</p></div> <hr> <p>In the PHP code, notice that we assigned the same callback for both authenticated and unauthenticated access. This guarantees that we will always answer to the given action.</p> <p>If you want to use the same callback for both states, use a <code>is_user_logged_in()</code> in the callback to differentiate these states. Alternatively, you can set two callbacks, one for each state.</p> <p>If your endpoint is for authenticated users only and you want to ignore unauthenticated users, you can only set the &quot;wp_ajax_*&quot; action.</p> <hr> <h2 id="security-check-permissions"><a href="#security-check-permissions" class="header-anchor">#</a> [SECURITY] Check permissions</h2> <ul><li><strong>NEVER</strong> allow sensitive actions to be executed by unauthenticated users (<code>wp_ajax_nopriv</code> with no permission checking).</li> <li><strong>ALWAYS</strong> check if the user has permissions (ex. <code>is_admin()</code> or <code>current_user_can()</code>) for authenticated actions.</li></ul> <h2 id="security-sanitization"><a href="#security-sanitization" class="header-anchor">#</a> [SECURITY] Sanitization</h2> <p>With few exceptions, you should <strong>ALWAYS sanitize the inputs</strong> before using them:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// my-plugin/my-plugin.php</span>
<span class="token variable">$action</span> <span class="token operator">=</span> <span class="token function">sanitize_text_field</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>sanitize_*</code> functions list:</p> <ul><li><code>sanitize_email()</code></li> <li><code>sanitize_file_name()</code></li> <li><code>sanitize_html_class()</code></li> <li><code>sanitize_key()</code></li> <li><code>sanitize_meta()</code></li> <li><code>sanitize_mime_type()</code></li> <li><code>sanitize_option()</code></li> <li><code>sanitize_sql_orderby()</code></li> <li><code>sanitize_text_field()</code></li> <li><code>sanitize_textarea_field()</code></li> <li><code>sanitize_title()</code></li> <li><code>sanitize_title_for_query()</code></li> <li><code>sanitize_title_with_dashes()</code></li> <li><code>sanitize_user()</code></li></ul> <p>You can also use PHP's core helpers like <code>intval( $value )</code> or create your own custom satinization method.</p> <h2 id="security-nonces"><a href="#security-nonces" class="header-anchor">#</a> [SECURITY] Nonces</h2> <p>Nonces prevent hackers from tricking you into clicking on a link that does a destructive action. If you are logged in as an admin user, a permission checking won't help you if you are tricked to click on a email with a link that deletes all your blog posts.</p> <p>There are two methods to work with nonces: <code>wp_create_nonce()</code> and <code>check_ajax_referer( $nonce )</code>. The first method creates a random string to be sent by the Ajax call. The second method verifies if the hash is valid.</p> <h2 id="_2-rest-api"><a href="#_2-rest-api" class="header-anchor">#</a> 2. REST API</h2> <p>Let's create this AJAX endpoint, using the REST API: <code>GET /my-namespace/v1/something</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_method_callback</span><span class="token punctuation">(</span> <span class="token variable">$request</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/** The response is automatically converted to JSON. */</span>
  <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">get_params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/** Routes should be created in the &quot;rest_api_init&quot; action. */</span>
<span class="token function">add_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'rest_api_init'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">register_rest_route</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-namespace/v1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/something'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'my_method_callback'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now open it in your browser:</p> <p><code>http://localhost:3000/index.php?rest_route=/my-namespace/v1/something</code> (change &quot;<em>localhost:3000</em>&quot; to your actual host)</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAocAAAB5CAMAAAB8zXuQAAAC+lBMVEX////19vfw8/QjIyO/xc0/Pz/t99wdHR0bHByvkIyVvOyAhIrw1au25fWQj4/o6euBh5VeX1/C8vWDlsnu9dDv9ebq/L2nhozl/v+t3Pb//9OykYmM2f/N9PWcyPLWrpHw47aPgJzh9PTv9eyFgKijpaXn8/RfYmj3///f4OHv68Vak+fY3eDx266AgYHv//8oJimj0vTQ1teys7bqyqOZhI/AaiUKCAuRpciCjrqEhrH/76Z5Liu0+/7//+c7k+CHo9aIhor9v2bv8eOUgZy43vbU7fVbFCqoxtT/+q/Qqo6Qho6AhY6VPxDw8/BKouqCjJ6fhZCFOyfK//////fP5vU0iNZMEDXv7/GYwuuTvubRz8jIrJ3/5JkTQJZmu/vr8/SPr+HLsqKAhaI/ED+KNA7//9/u9tfy3rMPUKiLgaf0tF65YBh3z/9vx////+///7kRK3AWW7OEka/hmkPSfy0QDxsnEA3F1/JfoOyJf5/atpadkI4hKTukTRVzLRSlqK2lkop5fID9zHUqK1s9Flf0pk4PFjdvSC9SMiLC+v+X4f+M0vcgab8eH2taIDZFNy9qHyqtWhteGxDX//+i5/+RuePRzdT/98soc8vx4sKSnr+zsasSSZ//t1e97PWOlbTJt6nv5p6QmJ0tP3P2wnBobG4XF1ksFVjNlVTcjTovIhTw68vW2MPPya6LhKDiw5zIoYxECivZ9PJYrvF9uuq6zOBEVpH91Yc2DmkWKVBDFg/J7/+s7/+/5frd3+mjxOXw79u5y9aas9FamM3t8cq2vL3Oy7mahJryzZbetJKrmo8kJ3RMSkmlaUGo0ubG09lMesLgzb7/6LfYw6grEDsxODne29S9pZfCm4sSNoiyfFy07f7CxsQnWqP+2pCf+PX98d9Bi8q+qLc7X563l4rxx4ShtdetqsrFsMD/9rxweHRTXVVHD1Vxd1TO9+F4pL1rnanar27KmmXC7fXw7+mZut6Zy80/WLtKdHS+5tnDzYiHz8+ixrdbeBmvAAAPb0lEQVR42uyaaWgTQRSAzauJR0yyUaMUrbaNGqIx2HhgRMGiKdLGYIXiCZ6g6E/94Y3WAwVB/aEBFTyqRcETUfGP9631whMVBPFCwftAEXyzuy/Zdbtuicas7nxYt9t5s+9l8jGzO0mjJk3zZGwWI49jHtIe3rZZjNt5HNOQ9tBrsxiv8jimIe2h02Yxwnkc05DysEfIZjFCeRzTkPLQbbMc7jyOWSAP62wWpC6PYxJkD8M2S8JvEc0Cenj71cuHNovy8CV/ajYF6KGNw8k13EOOGeAecswA95BjBkzrIXCshEk9BI61MKWHwLEaZvQQOJbDhB4Cx3qYz0PgWJBceRgOcw05hh56vAZfz+7Zc6R+o6fGa7d73R7UTU9Duz1s7KFnYXUgUL3QAwqm3D8IWqjF8WQd/CY3DsFPnHhRBbr4zs2CrKOtKdspjNMaj4bx+BHkoVZDu5GHnfVF3FhnF6nbGLbraej12sNGGp6tDbgXLnQHas9Cmjb9u4EWamkzvL5W382GuzKl2edmo0FF4WAX6OJo1hwahP9OVYYRWNMoyCKUIvO0VDyNhnb8DCAPtRp6bL9kpL6IG3GuS9psybAd0dPQ46lfRKWGgeogIMHqwMPf87DNmtmykFvczmHHxwMMGlshPCvWHJHu077ePf4bHt6cJ2bQ0rptB9DBIAJr2gRZQ5uixeB8nbQGxf9ZD0nDDEX01Nk32kRqdTwMi5cnEfU09NRWA0AgAADVtZ4/5eHJyFghHxJzJw3ZUzFacwRIdGyFOv6GhzeuhSbOif05D6mmLKFNcWJsqZBPf8uhh6RhpiLWkF7ifKirIYmo6+HCQJA8DAYWqj2ccn/1/MMx6bjtAexc3WPJQNnD2z3mHz6aivC9x6aVbdb06LGj/a5566QBG4U/6NzcaMHPR7YWjWZj6RvrdgobythEWSrUzHHBoIluoW8Z9Nobg12VowCkiL5V4GgnlLJIOke69i7xTXQ7J8XkTv6b7viwWOu2TuckekOovULYUCW9hb36FUgRlIoQa5KuvsUd3zwrUY56+O4NxIZ0mftK48OugiIKQJVcro4CATPHNxdQjJiCXTZRPnD83M3nBucbpdXmkYqn0QDppdH4ZeAhaZixiF57kjRE9DTUERHSVLshhbta5aGvz5I3G5dv+4DHt2efF0Cvsw+vHFkreXi4590VX7pQxOLJpxs/PtpmzelksnhXJfPw4829R6GQjXSLOa6fjwDd97rQQ7Srb+TcvIHjfeWThoy5O8fl7zjj0O5FeL6/1QH2hoAcES3D4zUWSecA/o7iXyPJA3KnqUVDQsmy1m0/hY51AQm5HS9+KVpGHkoRlAoIVhOL31Mx4+SYRa2Ke3VqSVMnlQl3rkXGdtqkjPKrklN1cqC/47AhkWQqRkyBl5XvCNefzzdKq80jFU+j4ZdfGo1fBh567Qq89T2hKOipbUf39CA906H2sK6H0hwYCEhzo8rDrau6Af43G/+BBJ6NS63LM48MoIjtS1fSuiwx1ymMlpUrLMr/+QiAaxHzkP3Avn4FXXt3ENeVrpUloirQtbIzTom0AhX27kCRdI5r/IwqqZU6tdjrUq661FuaWDEDeciOil6lTkRI1+Tfj8ZgA063MLXINdLj6ULJATlTWaKMUien6uRAllmRSkwhX5Y8NEqrzkPFU0H00uTxM6GH3lqlh7XeTDwU7Wo9/Do7Iv53dbdv30p7OP3II4o4M3z+pJjSw0F3tlR00PfQgc/KKQ9bdGrZvcgljmN3UYpOm3CQnRPSJjnaTaBIOofC8zG5lTqdeCKcqqrHQ7y42EXtIfX6GAwxuqRqgvJWXVgmXBzH74seKHc6o6/l5Ikb80qFeIkySp2cqpMDWWZFKpZCXHPntiomDw3SavKQh+lxY/lo/HK4LiOelzU2HVHpN4N1GT2kdVnfw6cjrjf+tqpeD8FXvnz+QdFDgt3o6K7LbEKo18Oiq8FgEJdV3/54tOyXHq5/XkyeUSf/jUtCSYM9pF4E1QQd2Ts/rSWbb/ZPgGAkEqLkhRWnQrt7lyij1MmpOjmQPKQYlgL2RV/j7it5aJBWk0fXw5w/p7A1OGzgYWbPKbjgKtflZUce4ZSn8pAi2O32gi/YovQwWqz7nHKxVbHKw66Vo6R1uTceEdTl66IJ42nEcdmhSDpXeEadEJxMpuDzEUHrdgexC7OXeShFUC9al6mmtBBnKj+3LQEGJcfOtC5TlDo5VScHyo0Uw1Kwcr4PPpry0CCtJo9UPBVELw3HL/f7NriRGMrQQ/19m9ZDD8ekp5DLm8TnlMf4MCLOh6yFPKSIFhsab1n+xbFgW8+NMXxenvLiWmRLxTppn6b3aM3R0W4dqDxk99uRPUUufzne2I+ZJT5s99rLLuVoh/fpl6IFFEnn2EzrMnXadTKEd/K+/TOujalSekg38wmWZGy/AimCetG6TDWlhUiUC6iT0sOp2vlQnZyqkwPFxmQZxYgp8I4vjuqRhwZpNXmk4qkgemny+OVyH/th2E5CGnvY8H1seLe6G5xguzL5KOX91T22lbDNmflLOrAW8pAinmILbt9cWI67NyjPrku4bSHtW5cKp7THqUUxtYfizrewuQr3IdgOeGJu9ACbXs4wD2vEfQuKpHOFh3InmDrPyfYw1i9yDstXeCjtnmADnLhbGhf6HpAiqBdBNaWFgMKKCaDyEDdnnPGamDJKnZyqkwPFzDOOUgxLgbTAO2fy0CCtNo9UPBVEL00ev9x8rnc29bmeLRMPtZ/rkYZZ5yJqZkTaJJ3z7Nd0BkUhMqhWP4Vx2uyQxe851NXW6EypdgUN/55D9pEeMxqGrofZrykRvHN3YDEQGVSrn8I4bXYgD/8qL9Mahs31vS/22NwwMvWwa6WT0a8g85ocT+IbyoDIoFr9FMZpswT/Huxfxh8MMY6NB44CM3r4f4vI+Wc85CJaEDN6yEW0Hqb0kJtoOUzqITfRYpjWQ46l4B5yzAD3kGMGuIccM8A95JgB9LAxh5Nr0MNGnB/smt1vS2EYwJ+kkZG4Qjgaf8C5kVOJ9EhqbTRBXDQSK6663lCWdq0u/eBiXBSn++jQdWxkgox99G7ZmHUTYpFMZCI1kWWZbMS3Ca4kLjzvqfe81WN0GL14f5my07fPnvb99Xnep8P573APOaUA95BTCnAPOaUA95BTCnAPOaUA95BTCnAPOaUA95BTCnAPOaXAdx6O1hkOAec3sTq2QyGWPQ1A8aYHG4FThIfmKglvXcfKkzaYm2271wCl+GXGI+5QlQgaxytXnqoGpy8hskvBClhQnuRZYdy7nf17LC3vIin2AcVpxsSKxX6v4mce+nYNXK8nMX01wCnCQ18b/GMPYWBPi86MBSOQbNMy8AbrgeJ5fOcIegihiRS95MLs/7aH0IMvAGe+Hh7Y+iFuODoMd+vkwX4Az1g0UtsPrTvScplpSgAVtsz5MaMuszdVwLata7Rlrfiwa0N5HrrqDjEPiRqaGffq4Xxt3eBsdEpQ9XTt0VywD86eNI2Qk0Mk0rEaLL0nlSuZ4CSNjtflyLMUXn970vRAgNc7omoysDQeIdcD3Wm5Yx1a39WSL32oUvh249lLPHx9yq2VwxpJSwb1ZMWaPHRR9PMRpZFGfVKXlg2mGfTwWVzuyCWjjEh4d1T5zD2cv4etR7YDYnwqPNxMBGsO3oBbQmy8T3yORng7J+HsQV2hY8v6nd2dLdRDusx6uHJoOombGrg4tP+m2hyjNkCyL6wXcc8g1jUMKh4HXj8fXOaouXSiQf2mp13QPIz0weWuchi9LUwnKwVLb2M4+N7RR6OjRqL1jACWTEIizyJ7bgsmMwyW5hkh8DQFocF1zhAWwMDhNhqwqT4nugeFpB6qTqpYdlezZPAbfB67gClsH28MJ2hUVg+Dq1uxrr5unpFGM27wKo2epIIerr/f+lKN622aBM6vPAzLE/XfC6Zqaa4RwYm7YFdOS6zh6paF2yUUua/QQ1cv3sbQoDlgG2w/iovOVwrmXcaN1aRF5vdpe2e59nNjTfWWd+XH2yWfjUb3OKZ2qvr0oj5htepgEtW0iBn32jDPU35Al4eZ9KilDQaODTMPs1vdgJAYAkvG6WvLr83GHW5sGceraFTmIcYI15BcybkXfPjCDYw3AMPokBPA+VU9zOaMYg3XD4AKRkwmU7oNAp/qItiFVMH0y/BVJ7tpK/QwFjWYTAYsTXNy+egk85FsvY14aNlardq7rVmW3aBF3R83lEU7y9FDb7tktmnR18bTCvZjC/mZPZVC61i6rCziJ2+O3FtlMT6HMrdmPfXx+EQqXCUxD2kJzuJzYsmQ4qneEYvKSovm4UoalZ0PiYeiKr+5CmsvnZfZu4nXwyI8dCbbfiCYOQGU6STZNL2HrB5uJ3uGOrB6yOYQHawf0/7Mth4LCptYNQ89joQAMeZhfvTnvX6w4B9UQAxPDOFyP62HbBBW09N0RNu/4F3MQ6I/gKpyXjL4+BFWmzUPV9CoBR5q9TBBJ3RKCF8+TlFzil6wy+P9YuDhDdh/VbT6aiRSXfp+sIyeD0kDCylr6DLr4akhOPtSAgqdUxheVIPOK9rWQ8xk8kOhh6RVW5PMQxrd+moLPMEebcm0C2uxquOU4QxF/Lnz4asU9ARXw/TTFLWeziuoyyM8DSD78IAJCHokafMKS6antqtc56FEo2L3bcnzEM+Hono+PDrpDCvUQz6n/KGHZF6OdLTAc/LXZkC604vbhcJlzk+5eTnQbVj0BpWgy3CilWtHqIdsTmGgXPTzG7b1WIOCFToPMYlHi2a7NA9pdJzl1RHV0jubjmB/zsZrF30mtXE0Ny9buzOy8qyCTuXs8xt7NCESOWXERj+voZ/fsGRcmYSo91CLah1bXDajecjmZdOjt3u4h/P3MIzt6D/gDVYEfAlRP7/MG3Ig0KGznnVLPU4cy8i49T2kx/85pOZzivAwG/8vv9czLrmBX4Xjy3jDgngI6zeI+AVzkb0gZC+kCuTswQL5x3gN2FU4f/f/ORhXbVJZLsFCYHQoI+LCeDh/XBn+i2E9peEhh8M9/MouHdAAAAAgDOrf2hqfgwzwxkMKPKTAQwo8pMBDCjykwEMKPKTAQwo8pMBDCjykwEMKPKTAQwo8pMBDCjykwEMKPKTAQwo8pMDDtUvHAgAAAACD/K2nsaMY4sBDDjzkwEMOPOTAQw485MBDDjzkwEMOPOTAQw485MBDDjzkwEMOPOTAQw485MBDDjzkwEMOPOTAQw485MBDDjxkIAfQMSDnU62KAAAAAElFTkSuQmCC" alt="REST Call on browser"></p> <div class="custom-block success"><p>Done!</p></div> <hr> <p>The format is: <code>{namespace}/{version}/{resource}</code>. For example, the core WP &quot;users&quot; endpoint is: <code>wp/v2/users</code>.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p><strong>NEVER</strong> add endpoints to the wp namespace. Ex. <code>wp/1/my-endpoint</code>. The <code>wp</code> namespace is reserved for the WordPress core.</p></div> <h3 id="_2-1-pretty-urls"><a href="#_2-1-pretty-urls" class="header-anchor">#</a> 2.1. Pretty URLs</h3> <p>If your website has pretty permalinks support, then you can call the route directly. Just add a <code>/wp-json</code> prefix:</p> <p><code>http://localhost:3000/wp-json/my-namespace/v1/my-method</code></p> <p>Use <code>rest_url( $path )</code> whenever you need to print the URL. This method detects if the installation supports pretty URLs and writes the correct URL:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token function">rest_url</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-namespace/v1/something'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>$url</code> will be:</p> <ul><li><strong>No pretty URL:</strong> <code>http://localhost:3000/index.php?rest_route=/my-namespace/v1/something</code></li> <li><strong>With pretty URL:</strong> <code>http://localhost:3000/wp-json/my-namespace/v1/something</code></li></ul> <h3 id="_2-2-restful-structure"><a href="#_2-2-restful-structure" class="header-anchor">#</a> 2.2. RESTful structure</h3> <p><strong>RESTful</strong> means to have a resource (ex. &quot;/users&quot;) and allow CRUD operations (create, read, update, delete) on it.</p> <p>The URL is the same for all CRUD operations. Which operation will be executed depends on the HTTP verb (GET, POST, etc):</p> <ul><li><strong>Index</strong> (get all items): <code>GET /users</code></li> <li><strong>Create</strong> an item: <code>POST /users</code></li> <li><strong>Read</strong> an item: <code>GET /users/:id</code></li> <li><strong>Update</strong> an item: <code>PATCH /users/:id</code> or <code>PUT /users/:id</code> or <code>POST /users/:id</code></li> <li><strong>Delete</strong> an item: <code>DELETE /users/:id</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>POST or PUT?</strong> There's an intense debate of which verb should be used to create an item. Some prefer POST, some prefer PUT. WordPress constants imply that you should use POST to create items, so that's my preference.</p></div> <h2 id="defining-multiple-actions"><a href="#defining-multiple-actions" class="header-anchor">#</a> Defining multiple actions</h2> <p>Let's say you want to add a POST operation to your &quot;/something&quot;:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">register_rest_route</span><span class="token punctuation">(</span>
  <span class="token string single-quoted-string">'my-namespace/v1'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'/something'</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_method_callback'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">,</span>
      <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_method2_callback'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In other words, pass your methods in an array.</p> <h3 id="_2-3-verb-constants"><a href="#_2-3-verb-constants" class="header-anchor">#</a> 2.3. Verb Constants</h3> <p>Instead of POST/GET/etc, use the API constants:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">register_rest_route</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-namespace/v1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/something'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token class-name static-context">WP_REST_Server</span><span class="token operator">::</span><span class="token constant">READABLE</span><span class="token punctuation">,</span> <span class="token comment">// &quot;READABLE&quot; == &quot;GET&quot;</span>
  <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_method_callback'</span> <span class="token punctuation">]</span>
<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>List of constants:</strong></p> <ul><li><code>READABLE</code> (GET)</li> <li><code>CREATABLE</code> (POST)</li> <li><code>EDITABLE</code> (PUT, PATCH)</li> <li><code>DELETABLE</code> (DELETE)</li></ul> <h3 id="_2-4-success"><a href="#_2-4-success" class="header-anchor">#</a> 2.4. Success</h3> <p>Alternatively, you can return a <code>WP_REST_Response</code> object. This allows you to customize the headers and other things in the response:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/** HTTP code 200 means &quot;Success&quot;. */</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WP_REST_Response</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'some'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'result'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-5-error"><a href="#_2-5-error" class="header-anchor">#</a> 2.5. Error</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/** HTTP code 404 means &quot;Not found&quot;. */</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WP_Error</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my_err_code'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'My err message'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token number">404</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Or, with a different syntax:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$error</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WP_Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$error</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my_err_code'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'My err message'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token number">404</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$error</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-6-security-restricting-access-to-the-endpoint"><a href="#_2-6-security-restricting-access-to-the-endpoint" class="header-anchor">#</a> 2.6. [SECURITY] Restricting access to the endpoint</h3> <p>Use <code>permission_callback</code> to validate a request:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">register_rest_route</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-namespace/v1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/something'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token class-name static-context">WP_REST_Server</span><span class="token operator">::</span><span class="token constant">READABLE</span><span class="token punctuation">,</span> <span class="token comment">// &quot;READABLE&quot; == &quot;GET&quot;</span>
  <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_method_callback'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'permission_callback'</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token variable">$request</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">current_user_can</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'edit_posts'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-7-arguments-parameters"><a href="#_2-7-arguments-parameters" class="header-anchor">#</a> 2.7. Arguments (parameters)</h3> <p>For an id, use the regex <code>(?P&lt;id&gt;\d+)</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">register_rest_route</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-namespace/v1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/something/(?P&lt;id&gt;\d+)'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_method_callback'</span> <span class="token punctuation">]</span>
<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAp0AAACNCAMAAADCQjG+AAAC/VBMVEX////19vcvLS3w8/QdHR3/AAC/xc3/f38/Pz/t99uvkIyVvexfYmjx3rJ/hIv4eHmmYDnC8fby+9yGganm9PVdXl7t///x1arn6evUrY/w9O6RgJz//tyt3PaAh5Wag5P0+O3//+fu9NGxsrWSvOV+f4Gcx/Hv7Mf16LySjo7d4OXS6fVclejw9eZUdcgQU6qXQA/S/f+khYz3//98MSejpaXLsKHP1deElcnr/LpjHirN9vXb9POIo9dIQ0j//+//76aKgaGVVDxRFC233fZXgMxjOUr///fw8OHc3d3//suBiZ6VlJa05ve65fXbtZaDhYv+97U9FFcnJiVHn+wMR5+MNhDC/f9Up/Hx/svCxcTGbyekTQ6x9Pzy+eRAl+OPsOD6yMiCj7r/4JaikYwRKXNGRFccDQqK1vyl0vO9zdt5Rzhwx/9nvfpJUJWJhonil0F0qeioxeY5kN3125UfIGO8ZR2ToMH+Y2MMDBNwJBL604FobG9jZGoDAQDv8PHS0M0gZryCiLKnqa6FkKjDoIs6GxTM8PnE4fi/0e3V2txgh9lzm7jozae0kIr5wWzypU5IbrvWwrL156DCknFHNCqg7vvnxZ7Fp51FXXu0cD/Pdyz9UlKWFhaY3/57uvOqzdvNy8vr/Ma+urzAvKYSQJSRhY7yzY3Npn5IOnQnPm5iTT9DEjzXijSHxPacuNTLzLirioz6e3vjrGb7uWDJkVVrWEuGWkMlJjUPFTUOFCGnwM3hzb2LjJEPHVG0//8xh9cpdMuMlbNCZqium4/muHxSKR6yWQ+NpcrW18NYgbzawqcdMYc1E2kkME5LCxdtNhDf//9bs/P/78j3oaL1slvYoVrBejyKRys0DUH9JiP//Pz/6+j/qqpbaJGwe1z+FBR3z//t4Nfh8///0tKbrcf/jY1vc3eP3/6d1/Zplc60pr5lc6WbnaIlU5j3a1f/Pj6nWyGac1Lv3cQ3YLOtj2ZYOVvOTU+rlanBxIv3hoeuERHuBASzX3voSkgqfazYAAAW10lEQVR42uycX0hTYRTAd+4tWXSjGhusHmK0IvtDbyZlXUJSEhb42oVEexj9gYUiJLVLkohpRqz/iRVmUEOQKHIP1ZMZYa+h0IOJEJLNFyMp9KHzffe2ddfdZphy7+754Xa/u+/s7OXnd+53Nq5rBUFYFbKTsC5kJ2FdyE7CuriE3/hKFD8UOH6lxCcQtiFlZwgcQkgg7MJvO3vAMfQIhE3Q7dwODmK7QNgDzU4fOApZIGyBZmcJOIoSgbAFmp0KOApFIGyBZmfBt5KM7BAIW6DZCQ5DIGwB2UlYF3M7/dVRSYpWGwp+zY0DYMQ4F9hQC/+BNT/aIANMfQByErjWQHYWIKZ2BlVJnZyUJDUIaTzrKsAcPoeP3VnUedUOCyYwGnlYvtubIf+6GOQE/zsWb6dCmyWrYWZnUFJbAJolJPgf7Dxafvm3ek8G5HDyEhv0yWOH/joie0/Xez5NiYu2c6P4z3bSkmo5TOz0q2oVQMmkhKj+/2pn61mltS/mhefhzkeJyPq/jgBD8fuALH7tTNkZDQESipKd9sPEzmqpBaBD0qg2GMhXv7u1or4M1sNQnzt8sU23M9yHc5AOCmwYcIen0E63272rODHsBcZopOxo+W4RGivrM4/41q7B/ag56jYgu3kyz40+WeqLoYEs6xYYmn0ANZgDEBblG2sQcbBp++vpdnYVoSg9HYbr5WlfCOX0TZOd9sPETlXFp9KtW1UJiRrtHAl3Kt/lem3wqB2+FfW0Vu7S7Yy87J2J308FoW+dpU/b0c7h0o6dup2BK4nL4nUUEV+uyDzywg5oJz7GiniywAtM9gbtDIzE3z39FL8feBE5MjR7AhAe9fS7uhrtPF7avGe6DbdHp/z+qg4vpEEzQ/hHld2GmNgpTQInxCq79KedKM9ltr5FyviAg6cxMVXZD6JdqaDzs/2Gyo5cld2DbfC4sp/li2UeRXgev8UT8WTX9WS8shfjCZ7tguLE2Okp4PComhfJ/byyb35zEu1kO7CJHWDUE+XMaadC3yNZEjM7EXWyBfwl08qk0c7GygcATCE+QG4n5LA86E3Z+RBNTAV5usLJBtFg5+Hmn4lIWVY7a7piXs3OdLJ+bicO3IwKgCE5Upa2E8/HjnE7PXcadDsP7xDJzkLArLJLnF4+juayE8+Tp5pn0nYyE9NBEHg/Iw97uZ1pzlf2X8cIVskzj8BLPCYyJtPtrO9AdmKtl8P9ee2kyl4ImO6KONM4bMnYFRVnVPar7DJz1GhnOgg0SZl2abCsP8i2K8LoY0Y7MVmFyO3ciwPt/bNbuiLr03YGbiTLjHZiZRdpV1QImHaUmJvBZoAq9Y+OUk1XpD214eGbld6GxsrhouZ1g142lxIqFVTccgr3MccCo/HPvQ1sV3T0R69i7CQZj5hCzLAzMCJ3Fj1KxPgnFvV+3f+wvEJkyrJ8nnV3Pyutai38YWfRDv8E3xVRR8n+mHfjJUlhK6cqBSHN44HdYqqjVPOEdYtYz8gdHhbZ3KqUnXoQvuhmPSBYMyOHp7ahTdtmsAGVPJS1G8/LuNFO3paSfVP6JybLRuJH2Ir8RbdzIByt9Rrs7Okp9QNC3Xj7k+ObTHwKwrIygoV9wegeG8HKTt9kFg55fgWyrHiwaC/eTvoVSOFgpV/QNWJ/lOwkrGlnTuj3nQ6E2+kGh+EWCDvA7VTBYUgCYQe4nWfAYZwRCDvA7awCh1ElEHbAJTjoBl90q69lZ9+5eyac2ycsCJfjblOjQTdKXAbezs2vzML83FshPy7nXXTSpefycHNuZU7mbgr5cDno1ohGlK20fi4l++ZX5mE+b313AUEsAR9WLoAPkBuyk1gK6nT/PnavffYXa7s/6tN1kAOyk1gSJsa5fN11We3t5gHjE5AdspNYEpq0wp2/9DdBdqxpp0jYnDpNztxBmp51uUKsZ6dI2J4mXtbzRfHi3pR93np2ioT9uTDOV8UFrbDjF7LOW85OkfjFzvmFNBXFcZy6EFuthbjRnDRh87rcWoSUq5yBtMDhX+olgkCGRC3KiqKHBolOMmlF/y2CLEX6RyYVCLkXsahM6aEoegmC6C9EFEQ9RL9zzv15dt3uZncO1/L34Nk95/v7w9nHc3aOw3/fDlLsXiUXvkoMcabRKcxYNtgz3NiT2IXEn04zjE5hxrLCfhHqFiTXLSC6X4rD00KnKM7Amd22AOlMVRdLp8loTEyXzXZQedBUbdRojBETQKgEp0YjJqfT1CrqdGKrKbpP+3q3EGs4oj1VKKRog4GJPZXdTmW568RhFUlSrikNKVSmxUlQpg4DpU4nwqlJRucKZTxtazTU1thEjRKcRqNGTAZnd1AXaW2N6ILdArdVy5cIsYYjl3FUNUHa/r65Ewifn1+TQD933uQCm31OlQqoCXKkzTCFirRYM06CFaeOU8cDpU4nh9OUmM6DynjaYF1shn/qLRJCleA0meLjGQ2nTnSQ1iHqNqVG56rVUq+rtLi+ag9ZDkt7LX2G2BZQrKjt3JMCnSPVNEOsWUuK5B2TV0BNQlpNniKcv4j3TapmnIRKnDpOHQZiUc2DjfVVfYYU6EQ4VeJpWqOxsVdBBTpFGh7xVILTFBThp04HP8SgaYroPBFwl1oWCea6qq4TvYUxLUxf3kqYuxToHAz4Siu8U0cn1pRGk6eoLG2yLMK+v6QzljoMJEW1Nva5Oy3b1NOJcKrFsxqho2unIpyIpyKdrToH0unQtcrp1L4+PbDTy9qrNcLd0wNbdkt0amYP7KwdV7hg6NrWVas3bFj/3t5YiPNp7YeXdf6yiS2Z50Iy1a7O4nrLfidZDZos1RU18J4Vk+cwgGeHAGQZpgpwsDSRFp/BFhdso4u0V3IyjxTrQ15riV4/vhjJxuk7fLaljCkwFRqtidbztqe4fqidQuNqK4cBXuZIRB/aI0SpBEGWnOTjQjqoHzqEGpoCwgJH5ULd0C1Y5Vgfc0ZZvPCsZpyEqKlj1P3Y76GBMCqL26CaToRTNZ5GTTPCCaYEJ+KpTKcY4a8jooxO14t9R3q2P8lxvRg70v2pTAjfu3V+9Ayjc6et7cF3AyoO3Ph4yda+avW6ZrfHXkLodI0AAPPJTC2sqJnY0k0Iphhm8KH7VmO54Mqr6mrurKgx54UCj8hz20pP3kqYcUnh96ASnwVYiFmv28OcIFtfR7PTWlLoc+BixMZJ8GG/E+lkCkwl23WJ/kRvKNDcuNIQzs3BZRaTC2/cHZ25OdEqsyw5VicJzXlV99yXPKihKSCs9AFxccEiKS1zNkt1xgvPasY6oqaOUfcbgpJAGBWXBxV0Il1RZox3HooyW+w4EKlkCC2XakRFOtl6qdOxdVRG50myU+9du5G0zKBrx/jOvmt0MyqOrd9KfLiuTm8pJCDWCgTRia0gAHpsiudRYOwFRXRntxfAbhTOPQQL5wq2b4OCzHgRKvEZ4BxqZ6PoRKPL3xQ2TnogA9JJW+7VpAez8JrMbeVUBgIoqfagyWTA5ALzk6t4cl6tJKSZeSqagoWtQY5oH3PGOuOFZzVHTwK+/kKo+wJ0kkBRdLry/M6MpdMYjKYzaFRDJ2Xu8sulpAUzX7k+e/YAp/P56BlU2F+OffZG01nZ0RMpUqSTbkLjU7wwNwcooHTOp6iQqT6rb+B8aY82oBKfhcX5XmkUnbTDVW+dMXTSuNRFTid6uXzUDFgTeZcNJBPZ1c/6PXl6vd8jJTcPVtdH6rdFq+TJsTpJSDPzVDQFCVvHOaJ9zBnrjBce6eSTgK+RThqI02muC7UL07+zk1Dvqmcp4ouvlHd2TmdETETngRuP5/xcy+m8w+mE39TrYxdhRHYA8Cjt7PSNkNNZw+jM73KAkQ989X5nQjq/vfUgfehkHhy2bEtAZ7+MTvRCA5mMTpA62xpgj3Y7xsvs7et4VCCjU54cq5OE9JeOpyIpaAVHOUe0jznHoxNdk9PJAmFUgBNSZ8CpiOziono65aeiRDv77dEzsDzK6EQFmbmv3yfQ6fconopg8ZDRaS+ZJ+3s0BILh9z9DcgX2e5Qic9R9KETGCxM1v55Cjs7YZrSCQruhTu7VBMHA/zulbBjLyYP55bB2iyjU54cq5OEUp2ooSng6R5AixzRPuaMdcYLDzUnoxMC8ahh+rkoE26U4OLTp5JO5Rsl67Kd7a7zY+TMU0va7k85dO1cvYOMIJ2oWLh/Ts/T49qv12ytXjiza7vd7h56g5TbdStOq4XFQ0YnPT6M5NewY8Rh+maEK2iouUOB5uGWQ6jEZxjGnR2d3gQ64ADhavMHLuEnLhzvegSnDdK6S1vKmAK9cGeXauJggJ8F8hBLsHbKk2N1kpANelBDU8BHynpwRY5oH3PGOuOFZzXHo5Od2aEPAmFUkD/s8Pkc038bv0nUIKbKdP79bbxw+/QSoRLui86R6zNor31wnTq9YWDLTTKCdKLiPozAxdLZ6xvGbgJS1uEmfajPwC71YltYJb1yOsnVj94y1E6vYKr2kOM4WU0onaFiPQygEp+j6JSchPkQAq5YvsFFNDsY8PEIDMBTZxMoPEyBXmhQk5xO6Opt4GEoKyOQIuSVqWTJsTpJSAdDtaihKSBQbxHniPYxZ6wzXnhWcyI6IRCPChdQYP6yafxLZvf4XzJnpUIn/0smwpl2I/AlNwRD4Tn9NdkLkHI11SZPgX3qDan70lIGgTLvWyBrgtUKy68myib/LZD0GzvUZBqdMTWZfb62csNU0YkplPtSovNHOQaaGjrTb+84nGJmfYMOju5pptNeoifWUqamJuSG7LJTRCemUO5LkU4PBPqn6Pyfv31s9lFzCNlvnLpsojO78fx/LEvpnMEzKyxb6ZzBMxssa+mc4fMPe3eMAyEIRGF4EjNSekZuwVEs6LzSVqskUxiPYTbGaLPRoYDsCu9roXwtPwV48qs37LN0Zb4YhjLstQX93vs+kviflS94uEaO2ekjlubyHOuEHPbKl3bLK4lErBNysDHd7ZdWP8Y6QfHbumwLkNwgvFn79kK/8kaG9g4dprCYZJYwEdTs/NXAdeZL585fDSjG7DkxPxNULHCEQBFGwxmYkaBeVlghNmqcjrNwmGfNPuzYsQ3AIAxE0WsQc7KFh2EziESBqD1CJKdIkyhIOBX3ZnDhf1U+zqNiRgw/iaCddWnhRZOOKT0YlehGNBj+npsr6RhP0ZwKJmVrqwRXyaosg2hFvdPef1LgsETr6a9wp9dkQLRgWD/BnRXbAJ3sl19IU1Ecx3+EkA9F9HLt4UbsqdHLvCyE6mFDhYEgMbd0sI09xLgzHcykwVSEEdztodAIjSnk0xDmn14UvDOWIirUyulQ11OIBJogSD7UQ9DvzHvuubpGakgw/D6M3XN/93d+fz7nnHvP9Q+6ePB1PbxQ5gAmvpFemUdfn87v+Vf7iTVooP8mvAKcVnyubI6D0pBCUdBAEnrY4F70AMpUVaulMzjT+bEJVNXd9gcMRoDJvu4H+FjFiBhKbON4b/zO3Q2t31/ErKh0lXZgOraZNhgWc29aYEMY85mqroMtZUswTHOkFTk01OsVjpsio1P/tYCvwhT1LVKoFWn8InXL7znWFry5BaUhhc7FWdZpqr/SeX96j9A5/+zWzT1v03+lE4FZUXlxhjk4WwUYKC9HfUBFK9L5uZ+dQnY4AZ3FVZii/unPpVYcvjF9bV7yaOi0YhdKQ3+kc90mOsgOOinJlw7RuZ5oYnSinNgLFOnHVlE6Ta65attUK1S0iGSNW9akkNwOMGATk7YnbqCiZvqcmJwTwFrjw655qBkJhuzQLJi63L5RE3Mgvkx5wSfNNX1yl+R1Y0e1Wx167Sq37S8DP4BBfOP4xnIxlpHHVe/ZHJ4D9chUrPzCboSa4Xg1jl8HmF8IpdpI/1dUTgwcdDb0A/64aUVMWE5Fq7hs0Y0YmhoCmprzk5RoSXqAVoSmOBivFlPjmMCC6BUIs7ERKXGVTJqMZRxHU0SZCZ1EFle4hOnMZuyA4neWP9Sy987V1Da/JyOdz5uzO3kMF1Pv8ud+9PJjOERngDRB/0ZXFdH6vYJmBDssOb9p7Xixqc/YEZwhyD4q2BSpmc61K2Qzs5RO1SyQarbgLDQYwpyBYzFjS/zq6xuHk/jGvPcqV/IXPWwNWJfCnLnGD/yPKAxLfr7R0yP7xsKqd2d80/I2gvmnBROez4oZ8K7diOVVFBdhm3F41MdAwYk2lHI5kQxaEYJrXjzJACZS9fA9CkpqaKlfsvekBaUibO+Uh3TBOEceOKAzLfCVM8igw7ImOo6myOgktbCztmA47UYoCf1m5/xemgrDOP4aB4pAKKpBYBeCiHcmp5u6mVByQMhQ0yVLdjFkQRtFy8EMBt5MuwglUxChuonEWDcp6Ap1gnZhTU1UrG5kV1EERn9A3/dsz56zI8dJLBzrfBGOyLPn7Hnfz54f55ypU/TZ94FrJdOJ7cF+WPdwTOf9y58spyJgBz9gvduFXW1z1K80pMwlm82w3X69WTPR2dgua9clv7BUTL4XclDf0jnY5gh5hHd7xNAGgvkdOi9O6KloD3hb5gZrO8j7WNdDNb2/AlC7Mmbwku7kQiBQuxk0gBIDJ/q5ZZamFQGH80Iq88GYnKlyGEJzJxov+L0fXbQiWTrx60CXi+kMSv/yFTL9m0I00ul0v4A9a8M3+1SUgtIUNSN4M53YlgTN7HnoHFqC+T50BvXkF26FkHOuvfKhOubQSWbU0k92u0x0NvfE8WolICyFLSNKJZ1zG6AzKF00gzp4j0QQDnl1PhlWFF+Q6LxI3td/ReOo6OgWZbfSmTETA3rNAJi6WYJBge/0mx4By7wiOpVMKdz40DdQaO550Inz0ooY+064YTqvSzrVGCywIeYQmU7n1kRf7u7Nl1LuPKpRo2TKnVj3A+ROL+DMTyePnOjysHkWdBpzJwovmfFIYCmUO6rwTCea4U2emolO1NpvQCdLZ4fBe81qUO6vzlHGjHMnVoQrOne7sAklaEW4ostelFZ0t9ZBoRGdtCJ56OTcaQyR6QScJ3PHpxLrO8VeOvVa3KnF0Hey3HIqYn1xt51GWV/ylJWpwqDFH3VmOuWaNji0d/fE+tuUtin3QHvPFZfN0Jyl0JzprdSDqCdrFus6J75+J854KmKh1yRemE7wGAVpZjoxrMB7lk4HeV9uEus9HsQ/e7XifK+aMQNs6Dsf9YuB7SrVudxPoPB0dDcZ9fOKQEAbIe2ml7X8uVqJa3YUGtFJK0IhWtBJfWduiJA2tBJQJZxNZWWCVIJTkQgxnTIXKpG40qs6p44cO8O5k6YiTlYRqFbVD3G/EeLZzr10ygk1nHwmauThtYBwC4DmFTajwVYsRpOjq56sWeUUxmf8nURTkRRfZqEcy3RqIf58MZ0VJ6aPja4yneQdB5xczuxL4Z99ZGaY2YfDcRyhofRwVEdZTPJEK0JXkujK0svhcHjiCoWWpZNWhEIkOt2KL6wkbxGdNLObQsQ5cbKZHRwgGk8pyNJQ5k7mGEbFgklmncO4k4m+jvoH07R0cHHtyCM5a+3TbiA761N/wa7/B8whWkt+KEpDmadAym+33hAFEhLXyKE8BaKdrdbGq4VRVHwLT6eoWVirWaizdnG8Hz+iEHqcEm+QWjnEPHcypxtK5U7mYT9Bp43f0XWqTvwTucO/1/6OzuLRlqIkq8R/KfvpY1vFK/ubG7aKWPa33mwVr+xvDNsqYtn/bcHWH3buWAAAAABgkL/1NHYUSGemGs4sXwAAAAAAAAC1B4cEAAAAAIL+v3aGBQAAAAAAAAAAAAAAAAAAAABYBKvoR1rxIERCAAAAAElFTkSuQmCC" alt="Show results on browser"></p> <p>Adapt the <code>&lt;id&gt;</code> to whatever your parameter is called. Also, change the <code>\d+</code> if you accept non-numeric values.</p> <h3 id="_2-8-security-validation-and-sanitization"><a href="#_2-8-security-validation-and-sanitization" class="header-anchor">#</a> 2.8. [SECURITY] Validation and Sanitization</h3> <p>Use <code>args</code> to configure your arguments settings. You don't need to define them all, just the ones you need custom settings (validation, sanitization, etc):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'args'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
  <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">/** Return true or false. */</span>
    <span class="token string single-quoted-string">'validate_callback'</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$param</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token variable">$value</span> <span class="token operator">&gt;=</span> <span class="token number">1900</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/** Sanitization allows you to clean the parameters. It happens AFTER validation. */</span>
    <span class="token string single-quoted-string">'sanitize_callback'</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$param</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">intval</span><span class="token punctuation">(</span> <span class="token variable">$value</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>You can use the <code>sanitize_*()</code> helpers, PHP's core helpers (ex. <code>intval()</code>) or any other methods you like.</p> <h4 id="alternative-method-sanitize-inputs-in-your-callback"><a href="#alternative-method-sanitize-inputs-in-your-callback" class="header-anchor">#</a> Alternative method – Sanitize inputs in your Callback</h4> <p>A simpler solution is to validate and sanitize the inputs in your callback, not in <code>args</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">function</span> <span class="token function">my_method_callback</span><span class="token punctuation">(</span> <span class="token variable">$request</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$parameters</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">get_params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$username</span>   <span class="token operator">=</span> <span class="token function">sanitize_text_field</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/** ... */</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>I prefer the first method (sanitization in args) because that's how WP wants us to do it. But feel free to decide which one you prefer the most.</p></div> <h3 id="_2-9-security-nonces"><a href="#_2-9-security-nonces" class="header-anchor">#</a> 2.9. [SECURITY] Nonces</h3> <p>I recommend using Nonces to protect your REST API, especially for the <strong>GET methods</strong> that do destructive actions. Although it's a <strong>bad practice</strong> to implement destructive actions on the GET verb (&quot;<em>destructive actions</em>&quot; means any action that changes the state, like creating a new user).</p> <p>There are two methods to work with nonces: <code>wp_create_nonce()</code> and <code>check_ajax_referer( $nonce )</code>. The first method creates a random string to be sent by the Ajax call. The second method verifies if the hash is valid.</p> <h2 id="_3-wp-rest-controller"><a href="#_3-wp-rest-controller" class="header-anchor">#</a> 3. <code>WP_REST_Controller</code></h2> <p>Starting on WordPress version <strong>4.7</strong>, you can define your REST API by creating a class inherited from the <code>WP_REST_Controller</code> class. Then, implement a <code>register_routes()</code> public method that will define your routes:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> MyRestRouter <span class="token keyword">extends</span> <span class="token class-name">WP_REST_Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register_routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">register_rest_route</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'my-namespace/v1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/something'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token string single-quoted-string">'methods'</span>  <span class="token operator">=&gt;</span> <span class="token class-name static-context">WP_REST_Server</span><span class="token operator">::</span><span class="token constant">READABLE</span><span class="token punctuation">,</span> <span class="token comment">// &quot;READABLE&quot; == &quot;GET&quot;</span>
      <span class="token string single-quoted-string">'callback'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my_method_callback'</span> <span class="token punctuation">]</span>
    <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Notice that you don't need the <code>rest_api_init</code> action.</p></div></div></div> <hr class="my-12" data-v-335698aa> <div data-v-335698aa><h2 class="text-xl md:text-3xl pb-10 text-center" data-v-335698aa>Comments</h2> <!----></div></div> <footer class="py-4 bg-gray-800" data-v-335698aa><p class="text-center text-gray-600 text-xs">Copyright 2022 - Daniel Loureiro</p></footer></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.5632ea00.js" defer></script><script src="/assets/js/3.9e1cc85f.js" defer></script><script src="/assets/js/25.53994f14.js" defer></script><script src="/assets/js/22.2ffb8c95.js" defer></script>
  </body>
</html>
